<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gest√£o de POPs e Switches</title>

  <style>
    :root {
      --bg-body: #f4f5f7;
      --bg-surface: #ffffff;
      --bg-surface-alt: #f8fafc;
      --bg-header: linear-gradient(135deg, #f9fafb, #e5edff);
      --border-subtle: #dde3ec;
      --shadow-soft: 0 8px 24px rgba(15, 23, 42, 0.06);

      --text-main: #111827;
      --text-muted: #6b7280;
      --text-soft: #9ca3af;
      --text-on-primary: #ffffff;

      --accent: #2563eb;
      --accent-soft: #dbeafe;
      --accent-strong: #1d4ed8;

      --success: #16a34a;
      --success-soft: #dcfce7;

      --warning: #f97316;
      --warning-soft: #ffedd5;

      --danger: #dc2626;
      --danger-soft: #fee2e2;

      --badge-pop: #f97316;
      --badge-switch: #0f766e;

      --sidebar-bg: #ffffff;
      --sidebar-border: #e5e7eb;
      --sidebar-hover: #eff6ff;
      --sidebar-active: #dbeafe;

      --radius-lg: 14px;
      --radius-md: 10px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-body);
      color: var(--text-main);
    }

    .app-container {
      display: flex;
      min-height: 100vh;
    }

    /* SIDEBAR */

    .sidebar {
      width: 250px;
      background: var(--sidebar-bg);
      border-right: 1px solid var(--sidebar-border);
      padding: 18px 14px;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0 6px 16px;
      border-bottom: 1px solid #e5e7eb;
      margin-bottom: 10px;
    }

    .sidebar-logo {
      width: 30px;
      height: 30px;
      border-radius: 8px;
      background: linear-gradient(145deg, #2563eb, #4f46e5);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #f9fafb;
      font-weight: 700;
      font-size: 17px;
    }

    .sidebar-title {
      font-size: 16px;
      font-weight: 600;
      color: #111827;
    }

    .sidebar-subtitle {
      font-size: 11px;
      color: #9ca3af;
    }

    .sidebar-nav {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .sidebar-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      cursor: pointer;
      color: #4b5563;
      font-size: 13px;
      transition: background 0.15s ease, color 0.15s ease, transform 0.08s ease;
    }

    .sidebar-item:hover {
      background: var(--sidebar-hover);
      color: #111827;
      transform: translateX(1px);
    }

    .sidebar-item.active {
      background: var(--sidebar-active);
      color: #1d4ed8;
      font-weight: 500;
    }

    .sidebar-item-icon {
      width: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 17px;
    }

    .sidebar-footer {
      margin-top: auto;
      padding-top: 10px;
      border-top: 1px solid #e5e7eb;
      font-size: 11px;
      color: #9ca3af;
    }

    /* CONTENT */

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 18px 22px;
      gap: 16px;
    }

    .header {
      background: var(--bg-header);
      border-radius: 16px;
      padding: 16px 18px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 12px;
    }

    .header-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .header-title {
      font-size: 20px;
      font-weight: 600;
      color: #111827;
    }

    .header-subtitle {
      font-size: 13px;
      color: #6b7280;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .summary-pill {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 999px;
      padding: 6px 10px;
      display: flex;
      gap: 10px;
      align-items: center;
      font-size: 12px;
      color: #4b5563;
      border: 1px solid rgba(209, 213, 219, 0.8);
    }

    .summary-pill span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .summary-pill strong {
      color: #111827;
      font-weight: 600;
    }

    .status-badge {
      padding: 5px 9px;
      border-radius: 999px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: var(--success-soft);
      color: #166534;
      border: 1px solid #bbf7d0;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
    }

    /* FILTERS / TOOLBAR */

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .toolbar-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .chip {
      border-radius: 999px;
      padding: 5px 10px;
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      color: var(--text-muted);
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background 0.12s ease, border-color 0.12s ease, box-shadow 0.12s ease;
    }

    .chip:hover {
      background: #f9fafb;
      border-color: #cbd5f5;
    }

    .chip.active {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: #1d4ed8;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.35);
    }

    .chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
    }

    /* LAYOUT PRINCIPAL */

    .content-grid {
      display: grid;
      grid-template-columns: minmax(0, 2.4fr) minmax(0, 1.6fr);
      gap: 14px;
    }

    @media (max-width: 1024px) {
      .app-container {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        flex-direction: row;
        align-items: center;
        overflow-x: auto;
      }
      .sidebar-header {
        border-bottom: none;
        margin-bottom: 0;
        margin-right: 10px;
        padding-bottom: 0;
      }
      .sidebar-nav {
        flex-direction: row;
        margin-top: 0;
      }
      .sidebar-item {
        white-space: nowrap;
      }
      .content-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    /* CARDS */

    .card {
      background: var(--bg-surface);
      border-radius: var(--radius-lg);
      padding: 12px 14px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(226, 232, 240, 0.9);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      color: #111827;
    }

    .card-subtitle {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* POPs LIST */

    .pops-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 420px;
      overflow: auto;
      padding-right: 4px;
    }

    .pop-item {
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      background: var(--bg-surface-alt);
      padding: 9px 10px;
      display: grid;
      grid-template-columns: minmax(0, 1.8fr) minmax(0, 1.4fr) auto;
      column-gap: 10px;
      row-gap: 6px;
      align-items: center;
      font-size: 12px;
      transition: border-color 0.12s ease, box-shadow 0.12s ease, background 0.12s ease, transform 0.08s ease;
      cursor: pointer;
    }

    .pop-item:hover {
      border-color: #bfdbfe;
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.06);
      background: #ffffff;
      transform: translateY(-1px);
    }

    .pop-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .pop-name-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pop-name {
      font-weight: 600;
      color: #111827;
    }

    .pop-uf {
      font-size: 11px;
      color: #6b7280;
    }

    .pop-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 2px;
    }

    .badge {
      border-radius: var(--radius-pill);
      padding: 2px 8px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .badge-pop {
      background: #fef3c7;
      color: #92400e;
    }

    .badge-switches {
      background: #ecfdf3;
      color: #166534;
    }

    .pop-meta {
      font-size: 11px;
      color: var(--text-muted);
    }

    .pop-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .more-link {
      font-size: 11px;
      color: #2563eb;
      display: inline-flex;
      align-items: center;
      gap: 3px;
      padding: 3px 7px;
      border-radius: 999px;
      background: #eff6ff;
    }

    .more-link svg {
      width: 13px;
      height: 13px;
    }

    /* HOVER PREVIEW DOS SWITCHES */

    .hover-preview {
      position: fixed;
      pointer-events: none;
      z-index: 50;
      transform: translate(10px, 8px);
      max-width: 320px;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 14px;
      padding: 10px 11px;
      border: 1px solid rgba(209, 213, 219, 0.9);
      box-shadow: 0 16px 38px rgba(15, 23, 42, 0.18);
      backdrop-filter: blur(8px);
    }

    .hover-preview-title {
      font-size: 12px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 6px;
    }

    .switch-list-mini {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 260px;
      overflow: auto;
    }

    .switch-item-mini {
      display: flex;
      gap: 8px;
      padding: 6px 7px;
      border-radius: 9px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      font-size: 11px;
    }

    .switch-mini-thumb {
      width: 46px;
      height: 34px;
      border-radius: 6px;
      background: #e5e7eb;
      overflow: hidden;
      flex-shrink: 0;
    }

    .switch-mini-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .switch-mini-body {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .switch-mini-title {
      font-weight: 600;
      color: #111827;
    }

    .switch-mini-meta {
      color: #6b7280;
    }

    .switch-mini-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 2px;
    }

    .tag {
      font-size: 10px;
      padding: 1px 6px;
      border-radius: 999px;
      background: #e5e7eb;
      color: #4b5563;
    }

    /* TABELA / DETALHES LADO DIREITO */

    .details-card {
      background: var(--bg-surface);
      border-radius: var(--radius-lg);
      padding: 10px 12px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(226, 232, 240, 0.9);
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 260px;
    }

    .details-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .details-title {
      font-size: 14px;
      font-weight: 600;
      color: #111827;
    }

    .details-subtitle {
      font-size: 11px;
      color: #6b7280;
    }

    .table-wrapper {
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      overflow: hidden;
      background: #f9fafb;
      max-height: 360px;
      display: flex;
      flex-direction: column;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    thead {
      background: #edf2ff;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    th, td {
      padding: 7px 8px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }

    th {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      color: #6b7280;
    }

    tbody tr:nth-child(odd) {
      background: #ffffff;
    }

    tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    tbody tr:hover {
      background: #eff6ff;
    }

    /* BOT√ïES GERAIS */

    button,
    .btn {
      border-radius: 999px;
      border: none;
      padding: 6px 12px;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: background 0.12s ease, box-shadow 0.12s ease, transform 0.05s ease;
      font-weight: 500;
    }

    .btn-primary {
      background: var(--accent);
      color: var(--text-on-primary);
      box-shadow: 0 8px 16px rgba(37, 99, 235, 0.25);
    }

    .btn-primary:hover {
      background: var(--accent-strong);
      transform: translateY(-0.5px);
    }

    .btn-ghost {
      background: #f3f4f6;
      color: #374151;
    }

    .btn-ghost:hover {
      background: #e5e7eb;
    }

    button:focus-visible,
    .btn:focus-visible {
      outline: 2px solid rgba(37, 99, 235, 0.9);
      outline-offset: 2px;
    }

    /* MODAL */

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
      backdrop-filter: blur(2px);
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal {
      background: #ffffff;
      border-radius: 16px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow: auto;
      box-shadow: 0 20px 50px rgba(15, 23, 42, 0.3);
    }

    .modal-header {
      background: linear-gradient(135deg, #f9fafb, #e5edff);
      padding: 14px 16px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 16px;
      font-weight: 600;
      color: #111827;
    }

    .modal-close {
      background: transparent;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #6b7280;
      padding: 0;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
    }

    .modal-close:hover {
      background: #f3f4f6;
      color: #111827;
    }

    .modal-body {
      padding: 14px 16px;
    }

    .modal-footer {
      padding: 10px 16px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .form-group {
      margin-bottom: 12px;
    }

    .form-group label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      color: #374151;
      margin-bottom: 4px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 7px 10px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 13px;
      font-family: inherit;
      background: #ffffff;
      color: #111827;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 70px;
    }

    /* LOADING SPINNER */

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 200px;
      font-size: 14px;
      color: #6b7280;
    }

    .spinner {
      border: 3px solid #e5e7eb;
      border-top-color: #2563eb;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      animation: spin 0.8s linear infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

  <div class="app-container">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">P</div>
        <div>
          <div class="sidebar-title">POPs Manager</div>
          <div class="sidebar-subtitle">v1.0</div>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="sidebar-item active" data-view="dashboard">
          <span class="sidebar-item-icon">üìä</span>
          <span>Dashboard</span>
        </div>
        <div class="sidebar-item" data-view="pops">
          <span class="sidebar-item-icon">üè¢</span>
          <span>POPs</span>
        </div>
        <div class="sidebar-item" data-view="switches">
          <span class="sidebar-item-icon">üîå</span>
          <span>Switches</span>
        </div>
        <div class="sidebar-item" data-view="fotos">
          <span class="sidebar-item-icon">üì∑</span>
          <span>Galeria</span>
        </div>
      </nav>
      <div class="sidebar-footer">
        ¬© 2025 POPs Manager
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main">
      <!-- HEADER -->
      <header class="header">
        <div class="header-left">
          <div class="header-title">Gest√£o de POPs e Switches</div>
          <div class="header-subtitle">Vis√£o geral da infraestrutura de rede</div>
        </div>
        <div class="header-right">
          <div class="summary-pill">
            <span>POPs: <strong id="totalPops">0</strong></span>
            <span>Switches: <strong id="totalSwitches">0</strong></span>
          </div>
          <div class="status-badge">
            <span class="status-dot"></span>
            Online
          </div>
        </div>
      </header>

      <!-- TOOLBAR / FILTROS -->
      <div class="toolbar">
        <div class="toolbar-group">
          <div class="chip active" data-filter="all">
            <span class="chip-dot"></span>
            Todos
          </div>
          <div class="chip" data-filter="uf">
            <span>üó∫Ô∏è</span>
            Por UF
          </div>
          <div class="chip" data-filter="cidade">
            <span>üèôÔ∏è</span>
            Por Cidade
          </div>
        </div>
        <button class="btn btn-primary" onclick="openAddPopModal()">
          ‚ûï Novo POP
        </button>
      </div>

      <!-- CONTENT GRID -->
      <div class="content-grid">
        <!-- LISTA DE POPs -->
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">POPs Cadastrados</div>
              <div class="card-subtitle">Clique para ver detalhes</div>
            </div>
          </div>
          <div id="popsContainer" class="pops-list">
            <div class="loading">
              <div class="spinner"></div>
              Carregando POPs...
            </div>
          </div>
        </div>

        <!-- DETALHES / TABELA -->
        <div class="details-card">
          <div class="details-header">
            <div>
              <div class="details-title">Detalhes</div>
              <div class="details-subtitle">Selecione um POP</div>
            </div>
          </div>
          <div id="detailsContainer">
            <p style="font-size: 12px; color: #9ca3af; text-align: center; margin-top: 40px;">
              Nenhum POP selecionado
            </p>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- HOVER PREVIEW (switches) -->
  <div id="hoverPreview" class="hover-preview" style="display: none;">
    <div class="hover-preview-title">Switches neste POP</div>
    <div id="hoverPreviewContent" class="switch-list-mini"></div>
  </div>

  <!-- MODAL ADICIONAR POP -->
  <div id="addPopModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Novo POP</div>
        <button class="modal-close" onclick="closeAddPopModal()">√ó</button>
      </div>
      <div class="modal-body">
        <form id="addPopForm">
          <div class="form-group">
            <label>Nome do POP</label>
            <input type="text" name="nome" required>
          </div>
          <div class="form-group">
            <label>UF</label>
            <input type="text" name="uf" maxlength="2" required>
          </div>
          <div class="form-group">
            <label>Cidade</label>
            <input type="text" name="cidade" required>
          </div>
          <div class="form-group">
            <label>Endere√ßo</label>
            <textarea name="endereco"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-ghost" onclick="closeAddPopModal()">Cancelar</button>
        <button class="btn btn-primary" onclick="submitAddPop()">Salvar</button>
      </div>
    </div>
  </div>

  <!-- FIREBASE SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // ========================================
    // 1. CONFIGURA√á√ÉO DO FIREBASE
    // ========================================
    // ‚ö†Ô∏è SUBSTITUA PELAS SUAS CREDENCIAIS REAIS
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_AUTH_DOMAIN",
      projectId: "SEU_PROJECT_ID",
      storageBucket: "SEU_STORAGE_BUCKET",
      messagingSenderId: "SEU_SENDER_ID",
      appId: "SEU_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ========================================
    // 2. ESTADO GLOBAL
    // ========================================
    let allPops = [];
    let allSwitches = [];
    let selectedPopId = null;

    // ========================================
    // 3. LISTENERS DO FIRESTORE
    // ========================================
    db.collection('pops').onSnapshot(snapshot => {
      allPops = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderWhenReady();
    });

    db.collection('switches').onSnapshot(snapshot => {
      allSwitches = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderWhenReady();
    });

    // ========================================
    // 4. RENDER PRINCIPAL (otimizado)
    // ========================================
    function renderWhenReady() {
      if (!allPops || !allSwitches) return;

      // Atualizar contadores
      document.getElementById('totalPops').textContent = allPops.length;
      document.getElementById('totalSwitches').textContent = allSwitches.length;

      // Renderizar lista de POPs
      renderEstadosComPops();
    }

    // ========================================
    // 5. OTIMIZA√á√ÉO: groupSwitchesByPop
    // ========================================
    function groupSwitchesByPop() {
      const map = {};
      allSwitches.forEach(sw => {
        const popId = sw.popId || 'sem-pop';
        if (!map[popId]) map[popId] = [];
        map[popId].push(sw);
      });
      return map;
    }

    // ========================================
    // 6. RENDERIZAR POPs (O(N) ao inv√©s de O(N¬≤))
    // ========================================
    function renderEstadosComPops() {
      const container = document.getElementById('popsContainer');
      if (!allPops.length) {
        container.innerHTML = '<p style="font-size: 12px; color: #9ca3af; text-align: center; padding: 20px;">Nenhum POP cadastrado</p>';
        return;
      }

      // Agrupar switches por POP uma √∫nica vez
      const switchesByPop = groupSwitchesByPop();

      // Agrupar POPs por UF
      const ufGroups = {};
      allPops.forEach(pop => {
        const uf = pop.uf || 'N/A';
        if (!ufGroups[uf]) ufGroups[uf] = [];
        ufGroups[uf].push(pop);
      });

      let html = '';

      Object.keys(ufGroups).sort().forEach(uf => {
        const popsInUf = ufGroups[uf];
        const totalSwitchesInUf = popsInUf.reduce((sum, pop) => {
          return sum + (switchesByPop[pop.id] || []).length;
        }, 0);

        popsInUf.forEach(pop => {
          const switchesInPop = switchesByPop[pop.id] || [];
          const numSwitches = switchesInPop.length;

          html += `
            <div class="pop-item" 
                 data-pop-id="${pop.id}"
                 onmouseenter="showHoverPreview(event, '${pop.id}')"
                 onmouseleave="hideHoverPreview()"
                 onclick="selectPop('${pop.id}')">
              <div class="pop-main">
                <div class="pop-name-row">
                  <span class="pop-name">${pop.nome}</span>
                  <span class="pop-uf">${pop.uf}</span>
                </div>
                <div class="pop-badges">
                  <span class="badge badge-pop">üè¢ POP</span>
                  <span class="badge badge-switches">üîå ${numSwitches} switch${numSwitches !== 1 ? 'es' : ''}</span>
                </div>
              </div>
              <div class="pop-meta">
                ${pop.cidade || 'N/A'}<br>
                ${pop.endereco || ''}
              </div>
              <div class="pop-actions">
                <span class="more-link">
                  Ver switches
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </span>
              </div>
            </div>
          `;
        });
      });

      container.innerHTML = html;
    }

    // ========================================
    // 7. HOVER PREVIEW
    // ========================================
    function showHoverPreview(event, popId) {
      const switchesInPop = allSwitches.filter(sw => sw.popId === popId);
      if (!switchesInPop.length) return;

      const preview = document.getElementById('hoverPreview');
      const content = document.getElementById('hoverPreviewContent');

      let html = '';
      switchesInPop.forEach(sw => {
        const thumb = sw.fotos && sw.fotos[0] ? sw.fotos[0] : '';
        html += `
          <div class="switch-item-mini">
            <div class="switch-mini-thumb">
              ${thumb ? `<img src="${thumb}" alt="${sw.modelo}">` : ''}
            </div>
            <div class="switch-mini-body">
              <div class="switch-mini-title">${sw.modelo || 'Switch'}</div>
              <div class="switch-mini-meta">${sw.marca || ''} ‚Ä¢ ${sw.portas || 0} portas</div>
              <div class="switch-mini-tags">
                ${sw.gerenciavel ? '<span class="tag">Gerenci√°vel</span>' : ''}
                ${sw.poe ? '<span class="tag">PoE</span>' : ''}
              </div>
            </div>
          </div>
        `;
      });

      content.innerHTML = html;
      preview.style.display = 'block';
      preview.style.left = event.pageX + 'px';
      preview.style.top = event.pageY + 'px';
    }

    function hideHoverPreview() {
      document.getElementById('hoverPreview').style.display = 'none';
    }

    // ========================================
    // 8. SELECIONAR POP (mostrar detalhes)
    // ========================================
    function selectPop(popId) {
      selectedPopId = popId;
      const pop = allPops.find(p => p.id === popId);
      const switchesInPop = allSwitches.filter(sw => sw.popId === popId);

      const container = document.getElementById('detailsContainer');

      if (!switchesInPop.length) {
        container.innerHTML = `
          <p style="font-size: 12px; color: #9ca3af; text-align: center; margin-top: 40px;">
            Nenhum switch cadastrado neste POP
          </p>
        `;
        return;
      }

      let tableHtml = `
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Modelo</th>
                <th>Marca</th>
                <th>Portas</th>
                <th>PoE</th>
              </tr>
            </thead>
            <tbody>
      `;

      switchesInPop.forEach(sw => {
        tableHtml += `
          <tr>
            <td>${sw.modelo || 'N/A'}</td>
            <td>${sw.marca || 'N/A'}</td>
            <td>${sw.portas || 0}</td>
            <td>${sw.poe ? '‚úÖ' : '‚ùå'}</td>
          </tr>
        `;
      });

      tableHtml += `
            </tbody>
          </table>
        </div>
      `;

      container.innerHTML = tableHtml;
    }

    // ========================================
    // 9. MODAL ADICIONAR POP
    // ========================================
    function openAddPopModal() {
      document.getElementById('addPopModal').classList.add('show');
    }

    function closeAddPopModal() {
      document.getElementById('addPopModal').classList.remove('show');
      document.getElementById('addPopForm').reset();
    }

    function submitAddPop() {
      const form = document.getElementById('addPopForm');
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      db.collection('pops').add(data)
        .then(() => {
          closeAddPopModal();
          alert('POP adicionado com sucesso!');
        })
        .catch(err => {
          console.error('Erro ao adicionar POP:', err);
          alert('Erro ao adicionar POP');
        });
    }

    // ========================================
    // 10. SIDEBAR NAVIGATION
    // ========================================
    document.querySelectorAll('.sidebar-item').forEach(item => {
      item.addEventListener('click', function() {
        document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
        this.classList.add('active');
        // Aqui voc√™ pode adicionar l√≥gica para trocar de view
      });
    });

    // ========================================
    // 11. FILTROS (CHIPS)
    // ========================================
    document.querySelectorAll('.chip').forEach(chip => {
      chip.addEventListener('click', function() {
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        this.classList.add('active');
        // Aqui voc√™ pode adicionar l√≥gica de filtro
      });
    });

    // ========================================
    // 12. OTIMIZA√á√ÉO: DEBOUNCE RESIZE
    // ========================================
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        // L√≥gica de ajuste de layout se necess√°rio
        console.log('Layout ajustado ap√≥s resize');
      }, 150);
    });

    // ========================================
    // 13. OTIMIZA√á√ÉO: ANIMATED FAVICON
    // ========================================
    let faviconAnimationStarted = false;
    let faviconAnimationDuration = 0;
    const MAX_FAVICON_DURATION = 15000; // 15 segundos

    function startFaviconAnimation() {
      if (faviconAnimationStarted) return;
      faviconAnimationStarted = true;

      const canvas = document.createElement('canvas');
      canvas.width = 32;
      canvas.height = 32;
      const ctx = canvas.getContext('2d');
      let frame = 0;

      const interval = setInterval(() => {
        faviconAnimationDuration += 250; // 4 FPS (1000/4 = 250ms)

        if (faviconAnimationDuration >= MAX_FAVICON_DURATION) {
          clearInterval(interval);
          return;
        }

        ctx.clearRect(0, 0, 32, 32);
        ctx.fillStyle = frame % 2 === 0 ? '#2563eb' : '#4f46e5';
        ctx.fillRect(0, 0, 32, 32);
        ctx.fillStyle = '#ffffff';
        ctx.font = 'bold 20px sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('P', 16, 16);

        const link = document.querySelector("link[rel*='icon']") || document.createElement('link');
        link.type = 'image/x-icon';
        link.rel = 'shortcut icon';
        link.href = canvas.toDataURL();
        document.getElementsByTagName('head')[0].appendChild(link);

        frame++;
      }, 250);
    }

    // Iniciar anima√ß√£o do favicon ap√≥s primeira intera√ß√£o
    document.addEventListener('pointerdown', startFaviconAnimation, { once: true });

  </script>

</body>
</html>
