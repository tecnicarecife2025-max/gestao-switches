<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gest√£o de Switches de Rede</title>

  <!-- Favicon base (fallback) -->
  <link id="dynamic-favicon" rel="icon" type="image/png"
        href="https://cdn-icons-png.flaticon.com/512/3749/3749786.png" />
  <meta name="theme-color" content="#111923">

  <!-- Anti-flicker: inicia colapsado via vari√°veis e sem anima√ß√µes at√© .js-ready -->
  <style>
    html:not(.js-ready) * { transition: none !important; animation: none !important; }
    html { --sbw: 52px; --sbw-collapsed: 52px; }
    html.js-ready { --sbw: 260px; --sbw-collapsed: 52px; }
  </style>

  <style>
    :root{ --sbw:260px; --sbw-collapsed:52px }
    *{ margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif }
    body{ background:#f5f7fa; color:#333 }
    .container{  
      width:100%;  
      max-width:1600px;  
      margin:0 auto;  
      padding:20px;  
    }

    /* ===== Sidebar ===== */
    .sidebar{
      position:fixed; left:0; top:0; bottom:0; width:var(--sbw);
      background:linear-gradient(180deg,#1a2530,#111923);
      color:#e5e7eb; box-shadow:2px 0 12px rgba(0,0,0,.15); z-index:1100;
      transition:width .25s ease, transform .25s ease;
      will-change:width, transform; overflow-x:hidden;
      display:flex; flex-direction:column;
    }
    .brand{ display:flex; align-items:center; gap:10px; justify-content:space-between;
      padding:12px; border-bottom:1px solid rgba(255,255,255,.06); min-height:56px }
    .brand-left{ display:flex; align-items:center; gap:10px; min-width:0 }
    .logo{ width:36px; height:36px; border-radius:10px; background:#2b3b4a;
      display:grid; place-items:center; font-weight:800; color:#a7c7ff;
      box-shadow:inset 0 0 0 1px rgba(255,255,255,.08) }
    .title{ font-size:14px; line-height:1.15; white-space:nowrap; transition:opacity .2s ease }
    .title b{ display:block; font-size:15px; color:#fff }
    .collapse-btn{
      background:#ffffff1a; border:1px solid #ffffff24; color:#fff;
      padding:8px 10px; border-radius:8px; cursor:pointer; transition:.2s;
      display:inline-flex; align-items:center; gap:8px; white-space:nowrap
    }
    .collapse-btn:hover{ background:#ffffff2d }
    .collapse-btn svg{ width:18px; height:18px; transition:transform .25s ease }

    .menu{ padding:10px; overflow:auto; flex:1 }
    .menu h4{ font-size:12px; color:#9fb0c2; letter-spacing:.06em; text-transform:uppercase;
      margin:10px 10px 6px; white-space:nowrap; transition:opacity .2s ease }
    .menu .item{
      display:flex; align-items:center; gap:10px; padding:12px 14px; margin:6px 6px;
      border-radius:10px; cursor:pointer; color:#e5e7eb; transition:.18s background, .18s transform;
      position:relative; white-space:nowrap; line-height:1;
    }
    .menu .item:hover{ background:rgba(255,255,255,.09) }
    .menu .item .icon{ width:22px; height:22px; display:grid; place-items:center; flex:0 0 22px; opacity:.95 }
    .menu .item .icon svg{ width:20px; height:20px }

    /* Rodap√© fixo na sidebar: bot√£o de cadeado */
    .sidebar-footer{
      padding:10px 6px 10px 6px;
      border-top:1px solid rgba(255,255,255,.06);
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:flex-start;
    }
    .lock-btn{
      display:flex; align-items:center; gap:10px; width:100%;
      background:#ffffff14; border:1px solid #ffffff24; color:#fff; cursor:pointer;
      padding:10px 12px; border-radius:10px; transition:background .2s ease, transform .1s ease
    }
    .lock-btn:hover{ background:#ffffff26 }
    .lock-btn:active{ transform:translateY(1px) }
    .lock-btn img{ width:20px; height:20px }
    .lock-badge{ margin-left:auto; font-size:12px; padding:.2rem .5rem; border-radius:999px; background:#0d1a24; border:1px solid #ffffff24 }

    /* Layout principal deslocado pela sidebar */
    .with-sidebar{ margin-left:var(--sbw); transition:margin-left .25s ease }

    /* Estado colapsado (desktop) */
    body.sidebar-collapsed .sidebar{ width:var(--sbw-collapsed) }
    body.sidebar-collapsed .with-sidebar{ margin-left:var(--sbw-collapsed) }
    body.sidebar-collapsed .title{ opacity:0; pointer-events:none }
    body.sidebar-collapsed .brand{ justify-content:center; gap:0 }
    body.sidebar-collapsed .logo{ display:none }
    body.sidebar-collapsed .collapse-btn span{ display:none }
    body.sidebar-collapsed .collapse-btn{ padding:8px }
    body.sidebar-collapsed .collapse-btn svg{ transform:rotate(180deg) }
    body.sidebar-collapsed .menu{ padding:8px 6px }
    body.sidebar-collapsed .menu h4{ height:0; margin:0; padding:0; opacity:0; overflow:hidden }
    body.sidebar-collapsed .menu .item{ justify-content:center; gap:0; padding:10px; margin:4px 6px; border-radius:12px }
    body.sidebar-collapsed .menu .item span{ display:none }

    /* >>> NOVO: em modo colapsado, mostrar s√≥ o √≠cone do cadeado <<< */
    body.sidebar-collapsed .sidebar-footer .lock-btn{
      justify-content:center;
      padding:10px;
    }
    body.sidebar-collapsed #lockText,
    body.sidebar-collapsed .lock-badge{
      display:none;
    }

    /* Mobile */
    @media (max-width: 900px){
      .sidebar { transform:translateX(-100%) }
      body.sidebar-open .sidebar { transform:none }
      .with-sidebar { margin-left:0 }
      .sidebar-overlay{ content:""; position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; z-index:1000 }
      body.sidebar-open .sidebar-overlay{ display:block }
      .edge-hitbox{ position:fixed; left:0; top:0; bottom:0; width:18px; z-index:900; background:transparent }
    }
    @media (min-width:901px){ .edge-hitbox{ display:none } }

    /* Header/Sections */
    header{ background:linear-gradient(135deg,#2c3e50,#1a2530); color:#fff; padding:20px; border-radius:10px; margin-bottom:30px; box-shadow:0 4px 12px rgba(0,0,0,.1) }
    .header-row{ text-align:center; display:block }
    h1{ margin-bottom:6px }
    .subtitle{ opacity:.9; font-weight:300; white-space:nowrap }

    .btn{ background:#3498db; color:#fff; border:0; padding:12px 16px; border-radius:6px; cursor:pointer; font-weight:600; transition:.25s; display:inline-flex; align-items:center; gap:8px }
    .btn:hover{ background:#2980b9 }
    .btn.ghost{ background:#ecf0f1; color:#2c3e50 }
    .btn.ghost:hover{ background:#d5dbdb }
    .btn.danger{ background:#e74c3c }
    .btn.danger:hover{ background:#c0392b }
    .btn.small{ padding:8px 10px; font-size:14px }

    .main-content{ display:flex; gap:30px; flex-wrap:wrap }
    .switches-section{ background:#fff; padding:25px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,.05); flex:1; min-width:320px }
    h2{ color:#2c3e50; margin-bottom:20px; padding-bottom:10px; border-bottom:2px solid #eee }
    .h3{ color:#2c3e50; margin:18px 0 10px; font-size:18px; font-weight:800 }
    .muted{ color:#7f8c8d; font-size:14px }
    .no-switches,.no-pops{ text-align:center; padding:40px; color:#7f8c8d; font-style:italic }

    .estado-block{ margin-bottom:32px }
    .estado-head{ display:flex; align-items:center; justify-content:space-between }
    .estado-badge{ background:#eef3f7; border:1px solid #e3e8ee; color:#2c3e50; font-weight:700; padding:4px 10px; border-radius:999px; font-size:12px }

    .pop-grid{ display:flex; flex-wrap:wrap; gap:20px; margin-top:12px; align-items:flex-start }
    .pop-card{ flex:1 1 320px; max-width:420px; background:#f8f9fa; border-radius:8px; overflow:visible; box-shadow:0 2px 8px rgba(0,0,0,.1); transition:transform .3s, box-shadow .3s }
    .pop-card:hover{ transform:translateY(-5px); box-shadow:0 5px 15px rgba(0,0,0,.1) }
    .pop-header{ display:flex; align-items:center; justify-content:space-between; padding:16px }
    .pop-title{ font-size:18px; font-weight:700; color:#2c3e50 }
    .pop-badge{ background:#ecf0f1; padding:4px 10px; border-radius:999px; font-size:12px; color:#2c3e50 }
    .pop-toggle{ width:100%; text-align:left; background:#eef3f7; border-top:1px solid #e3e8ee; padding:12px 16px; cursor:pointer; display:flex; align-items:center; justify-content:space-between }
    .pop-toggle span{ font-weight:600; color:#2c3e50 }
    .pop-toggle i{ transition:transform .2s }
    .pop-toggle.open i{ transform:rotate(180deg) }

    .switch-list{ display:none; padding:8px 16px 16px 16px; overflow:visible; position:relative }
    .switch-row{ background:#fff; border:1px solid #eee; border-radius:8px; padding:12px; display:flex; gap:12px; align-items:center; justify-content:space-between; position:relative; overflow:visible; margin-bottom:10px }
    .switch-info-wrap{ display:flex; flex-direction:column; gap:2px }
    .switch-name{ font-weight:700; color:#2c3e50 }
    .switch-meta{ font-size:14px; color:#7f8c8d }
    .row-actions{ display:flex; gap:8px; align-items:center }

    /* ===== TOOLTIP AJUSTADO: altura autom√°tica + scroll interno ===== */
    .hover-preview{ 
      position:absolute; 
      top:50%; 
      left:100%; 
      transform:translate(10px, -50%) scale(.98); 
      width:340px; 
      max-width:90vw; 
      height:auto;
      max-height:400px;
      overflow-y:auto;
      overflow-x:hidden;
      background:#fff; 
      border:1px solid #e6e9ef; 
      border-radius:10px; 
      box-shadow:0 10px 28px rgba(20,30,50,.18); 
      padding:10px; 
      opacity:0; 
      pointer-events:none; 
      transition:opacity .15s ease, transform .15s ease; 
      z-index:999;
      box-sizing:border-box;
    }
    .switch-row:hover .hover-preview{ 
      opacity:1; 
      transform:translate(10px, -50%) scale(1); 
      pointer-events:auto 
    }
    .hover-preview::before{ 
      content:""; 
      position:absolute; 
      top:50%; 
      left:-16px; 
      transform:translateY(-50%); 
      border-width:8px; 
      border-style:solid; 
      border-color:transparent #e6e9ef transparent transparent 
    }
    .hover-preview::after{ 
      content:""; 
      position:absolute; 
      top:50%; 
      left:-15px; 
      transform:translateY(-50%); 
      border-width:8px; 
      border-style:solid; 
      border-color:transparent #fff transparent transparent 
    }

    /* ===== NOVO: quando a linha tiver .hover-left, abrir tooltip para a ESQUERDA ===== */
    .switch-row.hover-left .hover-preview{
      left:auto;
      right:100%;
      transform:translate(-10px, -50%) scale(.98);
    }
    .switch-row.hover-left:hover .hover-preview{
      transform:translate(-10px, -50%) scale(1);
    }
    .switch-row.hover-left .hover-preview::before{
      left:auto;
      right:-16px;
      border-color:transparent transparent transparent #e6e9ef;
    }
    .switch-row.hover-left .hover-preview::after{
      left:auto;
      right:-15px;
      border-color:transparent transparent transparent #fff;
    }

    .hover-preview img{ 
      width:100%; 
      height:auto; 
      display:block; 
      border-radius:6px; 
      object-fit:cover; 
      max-height:240px;
      flex-shrink:0;
    }
    .hover-preview .noimg{ 
      color:#7f8c8d; 
      font-size:14px; 
      text-align:center; 
      padding:18px 6px;
      flex-shrink:0;
    }

    /* ===== BLOCO DE TEXTO DO MODELO NO TOOLTIP (AJUSTADO) ===== */
    .hover-preview .hover-model-block{
      margin-top:10px;
      padding:8px 10px;
      border-radius:8px;
      background:#f6f8fb;
      border:1px solid #e0e5f0;
      font-size:13px;
      color:#2c3e50;
      white-space:normal;
      word-wrap:break-word;
      overflow-wrap:break-word;
      line-height:1.4;
    }
    .hover-preview .hover-model-title{
      font-weight:700;
      margin-bottom:4px;
      word-wrap:break-word;
    }
    .hover-preview .hover-model-text{
      line-height:1.35;
      color:#4b5563;
      word-wrap:break-word;
      overflow-wrap:break-word;
    }

    .hover-preview .copy-btn{
      margin-top:8px;
      width:100%;
      justify-content:center;
      pointer-events:auto;
      flex-shrink:0;
    }

    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; padding:20px; z-index:1200 }
    .modal.open{ display:flex }
    .modal-content{ background:#fff; width:min(900px, 100%); max-height:90vh; border-radius:10px; box-shadow:0 10px 30px rgba(0,0,0,.25); overflow:auto }
    .modal-header{ padding:16px 20px; border-bottom:1px solid:#eee; display:flex; align-items:center; justify-content:space-between }
    .modal-title{ font-size:18px; font-weight:700 }
    .modal-body{ padding:20px }
    .modal-footer{ padding:16px 20px; border-top:1px solid:#eee; display:flex; gap:10px; justify-content:flex-end }
    .close-x{ background:transparent; border:0; font-size:20px; cursor:pointer }

    .form-group{ margin-bottom:16px }
    label{ display:block; margin-bottom:8px; font-weight:600; color:#2c3e50 }
    input,select{ width:100%; padding:12px; border:1px solid:#ddd; border-radius:5px; transition:border-color .3s }
    input:focus,select:focus{ border-color:#3498db; outline:0; box-shadow:0 0 0 2px rgba(52,152,219,.2) }
    .file-input-wrapper{ position:relative; overflow:hidden; display:inline-block; width:100% }
    .file-input-wrapper input[type=file]{ position:absolute; left:0; top:0; opacity:0; width:100%; height:100%; cursor:pointer }
    .file-input-button{ display:block; padding:12px; background:#ecf0f1; border:1px solid:#ddd; border-radius:5px; text-align:center; cursor:pointer; transition:background .3s }
    .file-input-button:hover{ background:#d5dbdb }

    .hide{ display:none !important }

    .loading-wrap{ display:flex; flex-direction:column; align-items:center; justify-content:center; padding:28px; min-height:140px }
    .progress{ width:100%; max-width:420px; height:10px; background:#e8eef6; border-radius:999px; overflow:hidden; position:relative }
    .progress .indeterminate{ position:absolute; left:-40%; top:0; bottom:0; width:40%; background:linear-gradient(90deg,#3498db,#6fb3ff); animation:indeterminate 1.2s infinite linear }
    @keyframes indeterminate{ 0%{left:-40%; width:40%} 50%{left:30%; width:30%} 100%{left:100%; width:40%} }

    /* ====== BLOQUEIO VISUAL ====== */
    body.locked .row-actions{ display:none !important }
    body.locked #menuNovoCadastro,
    body.locked #menuGerenciarPops{ display:none !important }
    body.locked .lock-badge{ background:#2a0f12 }

    /* ====== Modal de Senha ====== */
    .password-field{ position:relative }
    .password-field input{ width:100%; padding-right:44px }
    .password-field .eye{
      position:absolute; right:8px; top:50%; transform:translateY(-50%);
      width:34px; height:34px; border:0; background:transparent; cursor:pointer;
      border-radius:8px; display:grid; place-items:center; color:#2c3e50;
    }
    .password-field .eye:hover{ background:#ecf0f1 }
    .input-hint{ color:#e74c3c; margin-top:8px; font-size:14px }

    /* ====== MINI GALERIA ====== */
    .mini-gallery{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .mini-thumb{
      width:70px;
      height:50px;
      border-radius:4px;
      overflow:hidden;
      border:1px solid #ddd;
      background:#f4f4f4;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      cursor:pointer;
      transition:transform .2s, box-shadow .2s, border-color .2s;
    }
    .mini-thumb:hover{
      transform:scale(1.05);
      box-shadow:0 2px 8px rgba(0,0,0,.2);
    }
    .mini-thumb.selected{
      border-color:#3498db;
      box-shadow:0 0 0 2px rgba(52,152,219,.5);
    }
    .mini-thumb img{
      max-width:100%;
      max-height:100%;
      display:block;
      object-fit:cover;
    }
    .mini-thumb span{
      font-size:11px;
      color:#7f8c8d;
    }
  </style>
</head>

<body>
  <!-- Hitbox para abrir sidebar no mobile -->
  <div class="edge-hitbox" id="edgeHitbox"></div>

  <!-- Overlay escuro (mobile) -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- ===== SIDEBAR ===== -->
  <aside class="sidebar" id="sidebar">
    <div class="brand">
      <div class="brand-left">
        <div class="logo">SW</div>
        <div class="title">
          <b>Switch Manager</b>
          Gest√£o de Rede
        </div>
      </div>
      <button class="collapse-btn" id="collapseBtn">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        <span>Recolher</span>
      </button>
    </div>

    <nav class="menu">
      <h4>Menu Principal</h4>
      <div class="item" id="menuInicio">
        <div class="icon">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
          </svg>
        </div>
        <span>In√≠cio</span>
      </div>

      <div class="item" id="menuNovoCadastro">
        <div class="icon">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
        </div>
        <span>Novo Cadastro</span>
      </div>

      <div class="item" id="menuGerenciarPops">
        <div class="icon">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
          </svg>
        </div>
        <span>Gerenciar POPs</span>
      </div>

      <h4>Configura√ß√µes</h4>
      <div class="item" id="menuConfig">
        <div class="icon">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
        </div>
        <span>Configura√ß√µes</span>
      </div>
    </nav>

    <!-- Rodap√© da sidebar: bot√£o de bloqueio -->
    <div class="sidebar-footer">
      <button class="lock-btn" id="lockBtn">
        <img src="https://cdn-icons-png.flaticon.com/512/3064/3064197.png" alt="lock" id="lockIcon">
        <span id="lockText">Bloquear</span>
        <span class="lock-badge" id="lockBadge">üîì</span>
      </button>
    </div>
  </aside>

  <!-- ===== CONTE√öDO PRINCIPAL ===== -->
  <div class="with-sidebar">
    <div class="container">
      <header>
        <div class="header-row">
          <h1>üåê Gest√£o de Switches de Rede</h1>
          <p class="subtitle">Controle e monitore seus switches em tempo real</p>
        </div>
      </header>

      <div class="main-content">
        <section class="switches-section">
          <h2>üì° Switches Cadastrados</h2>
          <div id="switchesContainer">
            <div class="loading-wrap">
              <div class="progress"><div class="indeterminate"></div></div>
              <p style="margin-top:12px; color:#7f8c8d">Carregando switches...</p>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- ===== MODAL: NOVO SWITCH ===== -->
  <div class="modal" id="modalNovoSwitch">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">‚ûï Cadastrar Novo Switch</div>
        <button class="close-x" onclick="closeModal('modalNovoSwitch')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="formNovoSwitch">
          <div class="form-group">
            <label for="newHostname">Hostname</label>
            <input type="text" id="newHostname" placeholder="Ex: SW-CORE-01" required />
          </div>
          <div class="form-group">
            <label for="newIp">Endere√ßo IP</label>
            <input type="text" id="newIp" placeholder="Ex: 192.168.1.10" required />
          </div>
          <div class="form-group">
            <label for="newModelo">Modelo</label>
            <input type="text" id="newModelo" placeholder="Ex: Cisco Catalyst 2960" required />
          </div>
          <div class="form-group">
            <label for="newEstado">Estado</label>
            <select id="newEstado" required>
              <option value="">Selecione...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="newPop">POP</label>
            <select id="newPop" required>
              <option value="">Selecione...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="newImagem">Imagem do Switch (opcional)</label>
            <div class="file-input-wrapper">
              <input type="file" id="newImagem" accept="image/*" />
              <div class="file-input-button">üìÅ Escolher arquivo</div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn ghost" onclick="closeModal('modalNovoSwitch')">Cancelar</button>
        <button class="btn" onclick="salvarNovoSwitch()">Salvar</button>
      </div>
    </div>
  </div>

  <!-- ===== MODAL: EDITAR SWITCH ===== -->
  <div class="modal" id="modalEditarSwitch">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">‚úèÔ∏è Editar Switch</div>
        <button class="close-x" onclick="closeModal('modalEditarSwitch')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="formEditarSwitch">
          <input type="hidden" id="editId" />
          <div class="form-group">
            <label for="editHostname">Hostname</label>
            <input type="text" id="editHostname" required />
          </div>
          <div class="form-group">
            <label for="editIp">Endere√ßo IP</label>
            <input type="text" id="editIp" required />
          </div>
          <div class="form-group">
            <label for="editModelo">Modelo</label>
            <input type="text" id="editModelo" required />
          </div>
          <div class="form-group">
            <label for="editEstado">Estado</label>
            <select id="editEstado" required></select>
          </div>
          <div class="form-group">
            <label for="editPop">POP</label>
            <select id="editPop" required></select>
          </div>
          <div class="form-group">
            <label>Imagem Atual</label>
            <div id="editImagemAtual" style="margin-top:8px; color:#7f8c8d; font-size:14px">Nenhuma imagem</div>
            <div id="editMiniGallery" class="mini-gallery"></div>
          </div>
          <div class="form-group">
            <label for="editImagem">Alterar Imagem (opcional)</label>
            <div class="file-input-wrapper">
              <input type="file" id="editImagem" accept="image/*" />
              <div class="file-input-button">üìÅ Escolher nova imagem</div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn ghost" onclick="closeModal('modalEditarSwitch')">Cancelar</button>
        <button class="btn" onclick="salvarEdicaoSwitch()">Salvar Altera√ß√µes</button>
      </div>
    </div>
  </div>

  <!-- ===== MODAL: GERENCIAR POPs ===== -->
  <div class="modal" id="modalGerenciarPops">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">üè¢ Gerenciar POPs</div>
        <button class="close-x" onclick="closeModal('modalGerenciarPops')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="novoEstadoPop">Estado</label>
          <select id="novoEstadoPop">
            <option value="">Selecione...</option>
          </select>
        </div>
        <div class="form-group">
          <label for="novoNomePop">Nome do POP</label>
          <input type="text" id="novoNomePop" placeholder="Ex: POP Centro" />
        </div>
        <button class="btn" onclick="adicionarPop()">‚ûï Adicionar POP</button>

        <h3 class="h3">POPs Cadastrados</h3>
        <div id="listaPops" style="margin-top:12px"></div>
      </div>
      <div class="modal-footer">
        <button class="btn ghost" onclick="closeModal('modalGerenciarPops')">Fechar</button>
      </div>
    </div>
  </div>

  <!-- ===== MODAL: SENHA ===== -->
  <div class="modal" id="modalSenha">
    <div class="modal-content" style="max-width:420px">
      <div class="modal-header">
        <div class="modal-title">üîí Digite a Senha</div>
        <button class="close-x" onclick="closeModal('modalSenha')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="inputSenha">Senha</label>
          <div class="password-field">
            <input type="password" id="inputSenha" placeholder="Digite a senha" />
            <button type="button" class="eye" id="togglePassword">
              <svg id="eyeIcon" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
              </svg>
            </button>
          </div>
          <div class="input-hint hide" id="senhaErro">‚ùå Senha incorreta</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn ghost" onclick="closeModal('modalSenha')">Cancelar</button>
        <button class="btn" onclick="verificarSenha()">Confirmar</button>
      </div>
    </div>
  </div>

  <script>
    // ========== DADOS SIMULADOS ==========
    const ESTADOS_BR = [
      'Acre','Alagoas','Amap√°','Amazonas','Bahia','Cear√°','Distrito Federal',
      'Esp√≠rito Santo','Goi√°s','Maranh√£o','Mato Grosso','Mato Grosso do Sul',
      'Minas Gerais','Par√°','Para√≠ba','Paran√°','Pernambuco','Piau√≠',
      'Rio de Janeiro','Rio Grande do Norte','Rio Grande do Sul','Rond√¥nia',
      'Roraima','Santa Catarina','S√£o Paulo','Sergipe','Tocantins'
    ];

    // ========== MAPA DE DESCRI√á√ïES DOS MODELOS ==========
    const MODELO_DESCRICOES = {
      'DM4170 24GX+12XS': 'Switch L2/L3 Datacom com 24 portas Gigabit + 12 SFP+, empilh√°vel, ideal para agrega√ß√£o e acesso em redes corporativas.',
      'DM3224F2': 'Switch L2 Datacom com 24 portas Fast Ethernet + 2 SFP, gerenci√°vel, para redes de pequeno e m√©dio porte.',
      'DM3000': 'Switch L2 Datacom com portas Gigabit, gerenci√°vel, ideal para redes de acesso e distribui√ß√£o.',
      'DM4100': 'Switch L2/L3 Datacom empilh√°vel com portas Gigabit e uplinks 10G, para agrega√ß√£o e n√∫cleo de rede.',
      'EDD 2104': 'Switch Datacom com 4 portas Gigabit, compacto, para aplica√ß√µes de acesso e pequenas redes.',
      'Catalyst 2960': 'Switch Cisco L2 com portas Fast/Gigabit Ethernet, gerenci√°vel, amplamente usado em redes corporativas.',
      'Catalyst 9200': 'Switch Cisco L2/L3 empilh√°vel com portas Gigabit/10G, suporte a PoE+, ideal para campus e empresas.',
      'S5720': 'Switch Huawei L2/L3 com portas Gigabit/10G, empilh√°vel, para agrega√ß√£o e acesso em redes corporativas.',
      '2530': 'Switch HP/Aruba L2 com portas Gigabit, gerenci√°vel, para redes de pequeno e m√©dio porte.',
      'CRS326': 'Switch MikroTik L2 com 24 portas Gigabit + 2 SFP+, gerenci√°vel via RouterOS, para redes avan√ßadas.',
      'EX3300': 'Switch Juniper L2/L3 empilh√°vel com portas Gigabit/10G, para agrega√ß√£o e acesso em redes corporativas.',
      'GSW': 'Switch Planet com portas Gigabit, gerenci√°vel ou n√£o gerenci√°vel, para redes de pequeno porte.',
      'HUAWEI S6730-H48X6C': 'Switch Huawei de alta densidade com 48 portas 10GE SFP+ e 6 portas 100GE QSFP28, ideal para data centers e redes de campus de grande porte.',
      'MA5683T': 'OLT de acesso √≥ptico de m√©dia capacidade, chassis 5U com 6 slots de servi√ßo, suporta GPON/10G GPON/EPON/10G EPON/P2P.',
      'DM4100 ETH24GX+4XX+MPLS': 'Switch L2/L3 Datacom empilh√°vel com roteamento IP/MPLS, 24 portas Gigabit el√©tricas + 4 uplinks SFP, para acesso e agrega√ß√£o em redes Metro Ethernet.',
      'HUAWEI S6720-54C-EI-48S-DC': 'Switch 10GE de alto desempenho para data center/campus, 48 portas 10GE SFP+ + 2 portas 40GE QSFP+, capacidade de comuta√ß√£o 2,56 Tbit/s, suporta iStack e SVF.',
      'MA5800-X7': 'OLT de acesso √≥ptico de grande porte, arquitetura distribu√≠da, suporta GPON/XG(S)-PON/50G PON e interfaces GE/10GE, ideal para redes de banda larga gigabit com servi√ßos 4K/8K/VR.',
      'DM4008': 'Chassis modular DM4008 da fam√≠lia DM4000, switch Metro Ethernet para n√∫cleo/agrega√ß√£o, capacidade de fabric at√© 512 Gbit/s, suporta m√∫ltiplos cart√µes de interface GE/10GE e recursos avan√ßados de QoS e VPN.',
      'S12700': 'Switch modular Huawei de alta capacidade para n√∫cleo de data center/campus, arquitetura CLOS, capacidade de comuta√ß√£o at√© 768 Tbit/s, suporta interfaces 100GE/400GE, CloudEngine OS e recursos avan√ßados de virtualiza√ß√£o.'
    };

    let switches = [];
    let pops = {};
    let nextId = 1;
    let isLocked = false;
    const SENHA_CORRETA = '1234';

    // ========== INICIALIZA√á√ÉO ==========
    function init() {
      carregarDados();
      popularSelectEstados();
      renderSwitches();
      setupEventListeners();
      document.documentElement.classList.add('js-ready');
    }

    function carregarDados() {
      const saved = localStorage.getItem('switchesData');
      if (saved) {
        const data = JSON.parse(saved);
        switches = data.switches || [];
        pops = data.pops || {};
        nextId = data.nextId || 1;
      } else {
        // Dados de exemplo
        pops = {
          'S√£o Paulo': ['POP Centro', 'POP Zona Sul', 'POP Zona Norte'],
          'Rio de Janeiro': ['POP Centro', 'POP Barra'],
          'Minas Gerais': ['POP BH Centro']
        };
        switches = [
          { id: nextId++, hostname: 'SW-SP-CENTRO-01', ip: '192.168.1.10', modelo: 'DM4170 24GX+12XS', estado: 'S√£o Paulo', pop: 'POP Centro', imagem: 'https://www.datacom.com.br/wp-content/uploads/2021/03/DM4100-1.png' },
          { id: nextId++, hostname: 'SW-RJ-BARRA-01', ip: '192.168.2.20', modelo: 'DM3224F2', estado: 'Rio de Janeiro', pop: 'POP Barra', imagem: 'https://www.datacom.com.br/wp-content/uploads/2021/03/DM3000-1.png' },
          { id: nextId++, hostname: 'SW-MG-BH-01', ip: '192.168.3.30', modelo: 'DM4100', estado: 'Minas Gerais', pop: 'POP BH Centro', imagem: '' }
        ];
        salvarDados();
      }
    }

    function salvarDados() {
      localStorage.setItem('switchesData', JSON.stringify({ switches, pops, nextId }));
    }

    function popularSelectEstados() {
      const selects = ['newEstado', 'editEstado', 'novoEstadoPop'];
      selects.forEach(id => {
        const sel = document.getElementById(id);
        sel.innerHTML = '<option value="">Selecione...</option>';
        ESTADOS_BR.forEach(e => {
          const opt = document.createElement('option');
          opt.value = e;
          opt.textContent = e;
          sel.appendChild(opt);
        });
      });
    }

    function atualizarSelectPops(selectId, estadoSelecionado) {
      const sel = document.getElementById(selectId);
      sel.innerHTML = '<option value="">Selecione...</option>';
      if (estadoSelecionado && pops[estadoSelecionado]) {
        pops[estadoSelecionado].forEach(p => {
          const opt = document.createElement('option');
          opt.value = p;
          opt.textContent = p;
          sel.appendChild(opt);
        });
      }
    }

    // ========== RENDERIZA√á√ÉO ==========
    function renderSwitches() {
      const container = document.getElementById('switchesContainer');
      if (switches.length === 0) {
        container.innerHTML = '<div class="no-switches">Nenhum switch cadastrado ainda.</div>';
        return;
      }

      // Agrupar por estado
      const porEstado = {};
      switches.forEach(sw => {
        if (!porEstado[sw.estado]) porEstado[sw.estado] = [];
        porEstado[sw.estado].push(sw);
      });

      let html = '';
      for (const estado in porEstado) {
        const swsEstado = porEstado[estado];
        html += `
          <div class="estado-block">
            <div class="estado-head">
              <h3 class="h3">${estado}</h3>
              <span class="estado-badge">${swsEstado.length} switch${swsEstado.length>1?'es':''}</span>
            </div>
        `;

        // Agrupar por POP
        const porPop = {};
        swsEstado.forEach(sw => {
          if (!porPop[sw.pop]) porPop[sw.pop] = [];
          porPop[sw.pop].push(sw);
        });

        html += '<div class="pop-grid">';
        for (const pop in porPop) {
          const swsPop = porPop[pop];
          const popId = `pop-${estado.replace(/\s/g,'')}-${pop.replace(/\s/g,'')}`;
          html += `
            <div class="pop-card">
              <div class="pop-header">
                <div class="pop-title">${pop}</div>
                <span class="pop-badge">${swsPop.length}</span>
              </div>
              <button class="pop-toggle" onclick="togglePop('${popId}')">
                <span>Ver switches</span>
                <i>‚ñº</i>
              </button>
              <div class="switch-list" id="${popId}">
          `;
          swsPop.forEach(sw => {
            const imgHtml = sw.imagem 
              ? `<img src="${sw.imagem}" alt="${sw.modelo}" />`
              : `<div class="noimg">Sem imagem</div>`;
            
            const descricao = MODELO_DESCRICOES[sw.modelo] || 'Descri√ß√£o n√£o dispon√≠vel.';
            const descHtml = `
              <div class="hover-model-block">
                <div class="hover-model-title">Modelo: ${sw.modelo}</div>
                <div class="hover-model-text">${descricao}</div>
              </div>
            `;

            html += `
              <div class="switch-row" data-switch-id="${sw.id}">
                <div class="switch-info-wrap">
                  <div class="switch-name">${sw.hostname}</div>
                  <div class="switch-meta">IP: ${sw.ip}</div>
                  <div class="switch-meta">Modelo: ${sw.modelo}</div>
                </div>
                <div class="row-actions">
                  <button class="btn small ghost" onclick="editarSwitch(${sw.id})">‚úèÔ∏è Editar</button>
                  <button class="btn small danger" onclick="excluirSwitch(${sw.id})">üóëÔ∏è Excluir</button>
                </div>
                <div class="hover-preview">
                  ${imgHtml}
                  ${descHtml}
                  <button class="btn small copy-btn" onclick="copiarIP('${sw.ip}')">üìã Copiar IP</button>
                </div>
              </div>
            `;
          });
          html += `
              </div>
            </div>
          `;
        }
        html += '</div>'; // fecha pop-grid
        html += '</div>'; // fecha estado-block
      }

      container.innerHTML = html;

      // Ajustar dire√ß√£o dos tooltips
      setTimeout(adjustHoverDirections, 100);
    }

    function togglePop(popId) {
      const list = document.getElementById(popId);
      const btn = list.previousElementSibling;
      if (list.style.display === 'block') {
        list.style.display = 'none';
        btn.classList.remove('open');
      } else {
        list.style.display = 'block';
        btn.classList.add('open');
      }
    }

    function copiarIP(ip) {
      navigator.clipboard.writeText(ip).then(() => {
        alert(`IP ${ip} copiado!`);
      });
    }

    // ========== AJUSTE DE DIRE√á√ÉO DO TOOLTIP ==========
    function adjustHoverDirections() {
      const rows = document.querySelectorAll('.switch-row');
      rows.forEach(row => {
        const rect = row.getBoundingClientRect();
        const spaceRight = window.innerWidth - rect.right;
        if (spaceRight < 360) {
          row.classList.add('hover-left');
        } else {
          row.classList.remove('hover-left');
        }
      });
    }
    window.addEventListener('resize', adjustHoverDirections);

    // ========== CRUD SWITCHES ==========
    function salvarNovoSwitch() {
      const hostname = document.getElementById('newHostname').value.trim();
      const ip = document.getElementById('newIp').value.trim();
      const modelo = document.getElementById('newModelo').value.trim();
      const estado = document.getElementById('newEstado').value;
      const pop = document.getElementById('newPop').value;
      const imagemFile = document.getElementById('newImagem').files[0];

      if (!hostname || !ip || !modelo || !estado || !pop) {
        alert('Preencha todos os campos obrigat√≥rios.');
        return;
      }

      const novoSwitch = { id: nextId++, hostname, ip, modelo, estado, pop, imagem: '' };

      if (imagemFile) {
        const reader = new FileReader();
        reader.onload = e => {
          novoSwitch.imagem = e.target.result;
          switches.push(novoSwitch);
          salvarDados();
          renderSwitches();
          closeModal('modalNovoSwitch');
          document.getElementById('formNovoSwitch').reset();
        };
        reader.readAsDataURL(imagemFile);
      } else {
        switches.push(novoSwitch);
        salvarDados();
        renderSwitches();
        closeModal('modalNovoSwitch');
        document.getElementById('formNovoSwitch').reset();
      }
    }

    function editarSwitch(id) {
      const sw = switches.find(s => s.id === id);
      if (!sw) return;

      document.getElementById('editId').value = sw.id;
      document.getElementById('editHostname').value = sw.hostname;
      document.getElementById('editIp').value = sw.ip;
      document.getElementById('editModelo').value = sw.modelo;
      document.getElementById('editEstado').value = sw.estado;
      atualizarSelectPops('editPop', sw.estado);
      document.getElementById('editPop').value = sw.pop;

      const imgAtual = document.getElementById('editImagemAtual');
      const miniGallery = document.getElementById('editMiniGallery');
      if (sw.imagem) {
        imgAtual.innerHTML = `<img src="${sw.imagem}" style="max-width:200px; border-radius:6px; border:1px solid #ddd" />`;
        miniGallery.innerHTML = `
          <div class="mini-thumb selected" data-img="${sw.imagem}">
            <img src="${sw.imagem}" />
          </div>
        `;
      } else {
        imgAtual.textContent = 'Nenhuma imagem';
        miniGallery.innerHTML = '';
      }

      openModal('modalEditarSwitch');
    }

    function salvarEdicaoSwitch() {
      const id = parseInt(document.getElementById('editId').value);
      const sw = switches.find(s => s.id === id);
      if (!sw) return;

      sw.hostname = document.getElementById('editHostname').value.trim();
      sw.ip = document.getElementById('editIp').value.trim();
      sw.modelo = document.getElementById('editModelo').value.trim();
      sw.estado = document.getElementById('editEstado').value;
      sw.pop = document.getElementById('editPop').value;

      const imagemFile = document.getElementById('editImagem').files[0];
      if (imagemFile) {
        const reader = new FileReader();
        reader.onload = e => {
          sw.imagem = e.target.result;
          salvarDados();
          renderSwitches();
          closeModal('modalEditarSwitch');
        };
        reader.readAsDataURL(imagemFile);
      } else {
        salvarDados();
        renderSwitches();
        closeModal('modalEditarSwitch');
      }
    }

    function excluirSwitch(id) {
      if (!confirm('Tem certeza que deseja excluir este switch?')) return;
      switches = switches.filter(s => s.id !== id);
      salvarDados();
      renderSwitches();
    }

    // ========== GERENCIAR POPs ==========
    function adicionarPop() {
      const estado = document.getElementById('novoEstadoPop').value;
      const nome = document.getElementById('novoNomePop').value.trim();
      if (!estado || !nome) {
        alert('Selecione um estado e digite o nome do POP.');
        return;
      }
      if (!pops[estado]) pops[estado] = [];
      if (pops[estado].includes(nome)) {
        alert('Este POP j√° existe neste estado.');
        return;
      }
      pops[estado].push(nome);
      salvarDados();
      renderListaPops();
      document.getElementById('novoNomePop').value = '';
    }

    function renderListaPops() {
      const container = document.getElementById('listaPops');
      if (Object.keys(pops).length === 0) {
        container.innerHTML = '<div class="no-pops">Nenhum POP cadastrado.</div>';
        return;
      }
      let html = '';
      for (const estado in pops) {
        html += `<div style="margin-bottom:16px"><strong>${estado}</strong><ul style="margin-left:20px; margin-top:6px">`;
        pops[estado].forEach(p => {
          html += `<li style="margin-bottom:4px">${p} <button class="btn small danger" onclick="removerPop('${estado}','${p}')">üóëÔ∏è</button></li>`;
        });
        html += '</ul></div>';
      }
      container.innerHTML = html;
    }

    function removerPop(estado, nome) {
      if (!confirm(`Remover POP "${nome}" de ${estado}?`)) return;
      pops[estado] = pops[estado].filter(p => p !== nome);
      if (pops[estado].length === 0) delete pops[estado];
      salvarDados();
      renderListaPops();
    }

    // ========== BLOQUEIO/DESBLOQUEIO ==========
    function toggleLock() {
      if (isLocked) {
        openModal('modalSenha');
      } else {
        isLocked = true;
        document.body.classList.add('locked');
        document.getElementById('lockText').textContent = 'Desbloquear';
        document.getElementById('lockBadge').textContent = 'üîí';
        document.getElementById('lockIcon').src = 'https://cdn-icons-png.flaticon.com/512/3064/3064155.png';
      }
    }

    function verificarSenha() {
      const senha = document.getElementById('inputSenha').value;
      const erro = document.getElementById('senhaErro');
      if (senha === SENHA_CORRETA) {
        isLocked = false;
        document.body.classList.remove('locked');
        document.getElementById('lockText').textContent = 'Bloquear';
        document.getElementById('lockBadge').textContent = 'üîì';
        document.getElementById('lockIcon').src = 'https://cdn-icons-png.flaticon.com/512/3064/3064197.png';
        closeModal('modalSenha');
        document.getElementById('inputSenha').value = '';
        erro.classList.add('hide');
      } else {
        erro.classList.remove('hide');
      }
    }

    // ========== MODAIS ==========
    function openModal(id) {
      document.getElementById(id).classList.add('open');
      if (id === 'modalGerenciarPops') renderListaPops();
    }

    function closeModal(id) {
      document.getElementById(id).classList.remove('open');
      if (id === 'modalSenha') {
        document.getElementById('inputSenha').value = '';
        document.getElementById('senhaErro').classList.add('hide');
      }
    }

    // ========== SIDEBAR ==========
    function toggleSidebar() {
      document.body.classList.toggle('sidebar-collapsed');
    }

    function openSidebarMobile() {
      document.body.classList.add('sidebar-open');
    }

    function closeSidebarMobile() {
      document.body.classList.remove('sidebar-open');
    }

    // ========== EVENT LISTENERS ==========
    function setupEventListeners() {
      document.getElementById('collapseBtn').addEventListener('click', toggleSidebar);
      document.getElementById('menuInicio').addEventListener('click', () => alert('In√≠cio'));
      document.getElementById('menuNovoCadastro').addEventListener('click', () => openModal('modalNovoSwitch'));
      document.getElementById('menuGerenciarPops').addEventListener('click', () => openModal('modalGerenciarPops'));
      document.getElementById('menuConfig').addEventListener('click', () => alert('Configura√ß√µes'));
      document.getElementById('lockBtn').addEventListener('click', toggleLock);

      document.getElementById('newEstado').addEventListener('change', e => atualizarSelectPops('newPop', e.target.value));
      document.getElementById('editEstado').addEventListener('change', e => atualizarSelectPops('editPop', e.target.value));

      document.getElementById('sidebarOverlay').addEventListener('click', closeSidebarMobile);
      document.getElementById('edgeHitbox').addEventListener('mouseenter', openSidebarMobile);

      document.getElementById('togglePassword').addEventListener('click', () => {
        const input = document.getElementById('inputSenha');
        input.type = input.type === 'password' ? 'text' : 'password';
      });

      document.getElementById('inputSenha').addEventListener('keypress', e => {
        if (e.key === 'Enter') verificarSenha();
      });
    }

    // ========== INICIAR ==========
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
