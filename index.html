<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gest√£o de Switches de Rede</title>

  <!-- Favicon base (fallback) -->
  <link id="dynamic-favicon" rel="icon" type="image/png"
        href="https://cdn-icons-png.flaticon.com/512/3749/3749786.png" />
  <meta name="theme-color" content="#020617">

  <!-- Anti-flicker: inicia colapsado via vari√°veis e sem anima√ß√µes at√© .js-ready -->
  <style>
    html:not(.js-ready) * { transition: none !important; animation: none !important; }
    html { --sbw: 52px; --sbw-collapsed: 52px; }
    html.js-ready { --sbw: 260px; --sbw-collapsed: 52px; }
  </style>

  <style>
    :root{
      --sbw:260px;
      --sbw-collapsed:52px;
      --bg-body:#020617;          /* fundo quase preto azulado */
      --bg-app:#0b1120;           /* container geral */
      --bg-card:#020617;
      --bg-card-soft:#020617;
      --bg-chip:#0f172a;
      --border-subtle:#1e293b;
      --border-strong:#334155;
      --accent:#3b82f6;
      --accent-soft:rgba(59,130,246,0.12);
      --accent-soft-strong:rgba(59,130,246,0.18);
      --danger:#ef4444;
      --danger-soft:rgba(239,68,68,0.12);
      --text-main:#e5e7eb;
      --text-muted:#9ca3af;
      --text-soft:#6b7280;
      --shadow-soft:0 18px 45px rgba(15,23,42,0.9);
      --shadow-card:0 18px 45px rgba(15,23,42,0.7);
      --radius-lg:16px;
      --radius-md:12px;
    }

    *{
      margin:0;
      padding:0;
      box-sizing:border-box;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }

    body{
      background:radial-gradient(circle at top, #0b1120 0, #020617 55%, #000 100%);
      color:var(--text-main);
      min-height:100vh;
    }

    .container{
      max-width:1200px;
      margin:0 auto;
      padding:24px 18px 32px;
    }

    @media (min-width:1024px){
      .container{ padding:32px 24px 40px; }
    }

    /* ===== Sidebar ===== */
    .sidebar{
      position:fixed;
      left:0; top:0; bottom:0;
      width:var(--sbw);
      background:radial-gradient(circle at top left,#1f2937 0,#020617 55%,#000 100%);
      color:#e5e7eb;
      box-shadow:0 0 0 1px rgba(15,23,42,.9), 0 25px 70px rgba(0,0,0,.85);
      z-index:1100;
      transition:width .25s ease, transform .25s ease;
      will-change:width, transform;
      overflow-x:hidden;
      display:flex;
      flex-direction:column;
      backdrop-filter:blur(18px);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:space-between;
      padding:12px 14px;
      border-bottom:1px solid rgba(15,23,42,.9);
      min-height:60px;
    }
    .brand-left{ display:flex; align-items:center; gap:10px; min-width:0 }
    .logo{
      width:34px;
      height:34px;
      border-radius:10px;
      background:radial-gradient(circle at 20% 20%,#60a5fa 0,#1d4ed8 40%,#020617 100%);
      display:grid;
      place-items:center;
      font-weight:800;
      color:#e5f0ff;
      box-shadow:0 0 0 1px rgba(148,163,184,.7), 0 12px 25px rgba(15,23,42,.9);
      font-size:15px;
    }
    .title{
      font-size:13px;
      line-height:1.15;
      white-space:nowrap;
      transition:opacity .2s ease;
      color:var(--text-muted);
      text-transform:uppercase;
      letter-spacing:.12em;
    }
    .title b{
      display:block;
      font-size:15px;
      color:#f9fafb;
      letter-spacing:.08em;
    }

    .collapse-btn{
      background:rgba(15,23,42,.85);
      border:1px solid rgba(148,163,184,.4);
      color:#e5e7eb;
      padding:8px 10px;
      border-radius:999px;
      cursor:pointer;
      transition:.2s;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
      box-shadow:0 10px 30px rgba(15,23,42,.75);
      font-size:12px;
    }
    .collapse-btn span{
      text-transform:uppercase;
      letter-spacing:.08em;
      font-weight:600;
      color:#9ca3af;
    }
    .collapse-btn:hover{
      background:rgba(15,23,42,1);
      border-color:rgba(148,163,184,.7);
    }
    .collapse-btn svg{
      width:18px; height:18px;
      transition:transform .25s ease;
    }

    .menu{
      padding:12px 10px 12px;
      overflow:auto;
      flex:1;
    }
    .menu h4{
      font-size:10px;
      color:#6b7280;
      letter-spacing:.16em;
      text-transform:uppercase;
      margin:6px 12px 4px;
      white-space:nowrap;
      transition:opacity .2s ease;
    }
    .menu .item{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      margin:4px 6px;
      border-radius:999px;
      cursor:pointer;
      color:#e5e7eb;
      transition:.16s background, .16s transform, .16s box-shadow;
      position:relative;
      white-space:nowrap;
      line-height:1;
      background:transparent;
      border:1px solid transparent;
    }
    .menu .item:hover{
      background:rgba(15,23,42,.85);
      transform:translateY(-1px);
      box-shadow:0 10px 22px rgba(15,23,42,.85);
      border-color:rgba(148,163,184,.4);
    }
    .menu .item .icon{
      width:22px;
      height:22px;
      display:grid;
      place-items:center;
      flex:0 0 22px;
      opacity:.95;
      color:#93c5fd;
    }
    .menu .item .icon svg{ width:18px; height:18px }
    .menu .item span{
      font-size:13px;
      font-weight:500;
    }

    /* Rodap√© fixo na sidebar: bot√£o de cadeado */
    .sidebar-footer{
      padding:10px 8px 12px;
      border-top:1px solid rgba(15,23,42,.9);
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:flex-start;
      background:linear-gradient(to top,rgba(15,23,42,.9),transparent);
    }
    .lock-btn{
      display:flex;
      align-items:center;
      gap:8px;
      width:100%;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.4);
      color:#e5e7eb;
      cursor:pointer;
      padding:9px 10px;
      border-radius:999px;
      transition:background .2s ease, transform .1s ease, box-shadow .2s ease;
      font-size:12px;
      box-shadow:0 12px 30px rgba(15,23,42,.9);
    }
    .lock-btn:hover{
      background:rgba(15,23,42,1);
      box-shadow:0 18px 45px rgba(15,23,42,1);
    }
    .lock-btn:active{ transform:translateY(1px) }
    .lock-btn img{ width:18px; height:18px }
    .lock-badge{
      margin-left:auto;
      font-size:11px;
      padding:.18rem .5rem;
      border-radius:999px;
      background:#0b1120;
      border:1px solid rgba(148,163,184,.6);
      text-transform:uppercase;
      letter-spacing:.08em;
    }

    /* Layout principal deslocado pela sidebar */
    .with-sidebar{
      margin-left:var(--sbw);
      transition:margin-left .25s ease;
    }

    /* Estado colapsado (desktop) */
    body.sidebar-collapsed .sidebar{ width:var(--sbw-collapsed) }
    body.sidebar-collapsed .with-sidebar{ margin-left:var(--sbw-collapsed) }
    body.sidebar-collapsed .title{ opacity:0; pointer-events:none }
    body.sidebar-collapsed .brand{ justify-content:center; gap:0 }
    body.sidebar-collapsed .logo{ display:none }
    body.sidebar-collapsed .collapse-btn span{ display:none }
    body.sidebar-collapsed .collapse-btn{
      padding:8px;
      border-radius:999px;
    }
    body.sidebar-collapsed .collapse-btn svg{ transform:rotate(180deg) }
    body.sidebar-collapsed .menu{ padding:8px 6px }
    body.sidebar-collapsed .menu h4{
      height:0;
      margin:0;
      padding:0;
      opacity:0;
      overflow:hidden;
    }
    body.sidebar-collapsed .menu .item{
      justify-content:center;
      gap:0;
      padding:10px;
      margin:4px 6px;
      border-radius:12px;
    }
    body.sidebar-collapsed .menu .item span{ display:none }

    /* Mobile */
    @media (max-width: 900px){
      .sidebar { transform:translateX(-100%) }
      body.sidebar-open .sidebar { transform:none }
      .with-sidebar { margin-left:0 }
      .sidebar-overlay{
        content:"";
        position:fixed;
        inset:0;
        background:rgba(15,23,42,.72);
        display:none;
        z-index:1000;
        backdrop-filter:blur(6px);
      }
      body.sidebar-open .sidebar-overlay{ display:block }
      .edge-hitbox{
        position:fixed;
        left:0; top:0; bottom:0;
        width:18px;
        z-index:900;
        background:transparent;
      }
    }
    @media (min-width:901px){ .edge-hitbox{ display:none } }

    /* Header/Sections */
    header{
      background:
        radial-gradient(circle at top left, rgba(59,130,246,0.2), transparent 55%),
        linear-gradient(135deg,#020617,#020617);
      color:#f9fafb;
      padding:18px 18px;
      border-radius:var(--radius-lg);
      margin-bottom:28px;
      box-shadow:var(--shadow-soft);
      border:1px solid rgba(51,65,85,.9);
      position:relative;
      overflow:hidden;
    }
    header::after{
      content:"";
      position:absolute;
      inset:-80px;
      background:
        radial-gradient(circle at 0 0,rgba(59,130,246,.18),transparent 60%),
        radial-gradient(circle at 100% 0,rgba(56,189,248,.16),transparent 58%);
      opacity:.9;
      pointer-events:none;
      mix-blend-mode:screen;
    }

    .header-row{
      position:relative;
      display:flex;
      flex-direction:column;
      gap:16px;
      z-index:1;
    }
    @media (min-width:900px){
      .header-row{
        flex-direction:row;
        align-items:center;
        justify-content:space-between;
      }
    }

    .header-main{
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    h1{
      margin-bottom:2px;
      font-size:22px;
      letter-spacing:.02em;
    }
    @media (min-width:900px){
      h1{ font-size:24px; }
    }

    .subtitle{
      opacity:.85;
      font-weight:400;
      white-space:nowrap;
      font-size:13px;
      color:#cbd5f5;
    }

    .header-meta{
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:flex-start;
    }
    @media (min-width:900px){
      .header-meta{
        align-items:flex-end;
      }
    }

    .env-badge{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.16em;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.65);
      background-color:rgba(15,23,42,.85);
      color:#e5e7eb;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .env-dot{
      width:7px;
      height:7px;
      border-radius:50%;
      background:radial-gradient(circle at 30% 30%,#bbf7d0,#22c55e);
      box-shadow:0 0 0 4px rgba(22,163,74,.18);
    }

    .header-stats{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-start;
    }
    @media (min-width:900px){
      .header-stats{ justify-content:flex-end; }
    }
    .stat-chip{
      padding:5px 10px;
      border-radius:999px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.45);
      font-size:11px;
      display:flex;
      align-items:center;
      gap:6px;
      color:#cbd5f5;
    }
    .stat-chip span{
      font-weight:500;
      opacity:.9;
    }
    .stat-chip strong{
      font-weight:600;
      color:#e5e7eb;
    }

    .main-content{
      display:flex;
      gap:24px;
      flex-wrap:wrap;
    }

    .switches-section{
      background:var(--bg-app);
      padding:22px 20px 20px;
      border-radius:var(--radius-lg);
      box-shadow:var(--shadow-card);
      flex:1;
      min-width:320px;
      border:1px solid var(--border-subtle);
    }

    h2{
      color:#e5e7eb;
      margin-bottom:18px;
      padding-bottom:10px;
      border-bottom:1px solid rgba(30,64,175,.8);
      font-size:16px;
      letter-spacing:.06em;
      text-transform:uppercase;
      display:flex;
      align-items:center;
      gap:8px;
    }
    h2::before{
      content:"";
      width:8px;
      height:8px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 30%,#60a5fa,#1d4ed8);
      box-shadow:0 0 0 4px rgba(37,99,235,.3);
    }

    .h3{
      color:#e5e7eb;
      margin:18px 0 8px;
      font-size:15px;
      font-weight:700;
      letter-spacing:.04em;
      text-transform:uppercase;
    }

    .muted{
      color:var(--text-muted);
      font-size:13px;
    }
    .no-switches,.no-pops{
      text-align:center;
      padding:32px 24px;
      color:var(--text-soft);
      font-style:italic;
      font-size:13px;
    }

    .estado-block{ margin-bottom:26px }
    .estado-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .estado-badge{
      background:var(--bg-chip);
      border:1px solid var(--border-subtle);
      color:#e5e7eb;
      font-weight:500;
      padding:4px 10px;
      border-radius:999px;
      font-size:11px;
      display:flex;
      align-items:center;
      gap:6px;
    }

    .pop-grid{
      display:flex;
      flex-wrap:wrap;
      gap:16px;
      margin-top:12px;
      align-items:flex-start;
    }

    .pop-card{
      flex:1 1 320px;
      max-width:420px;
      background:var(--bg-card);
      border-radius:var(--radius-md);
      overflow:visible;
      box-shadow:0 18px 45px rgba(15,23,42,.85);
      transition:transform .2s, box-shadow .2s, border-color .2s, background .2s;
      border:1px solid var(--border-subtle);
      position:relative;
    }
    .pop-card::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      border:1px solid transparent;
      pointer-events:none;
      opacity:0;
      transition:opacity .2s;
      background:linear-gradient(135deg,rgba(59,130,246,.5),rgba(236,72,153,.45));
      mix-blend-mode:soft-light;
    }
    .pop-card:hover{
      transform:translateY(-3px);
      box-shadow:0 26px 60px rgba(15,23,42,1);
      border-color:rgba(59,130,246,.7);
      background:radial-gradient(circle at top,rgba(15,23,42,.9),#020617 60%);
    }
    .pop-card:hover::before{ opacity:.3 }

    .pop-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 14px 10px;
    }
    .pop-title{
      font-size:15px;
      font-weight:600;
      color:#e5e7eb;
    }
    .pop-badge{
      background:var(--bg-chip);
      padding:4px 9px;
      border-radius:999px;
      font-size:11px;
      color:var(--text-muted);
      border:1px solid var(--border-subtle);
    }

    .pop-toggle{
      width:100%;
      text-align:left;
      background:rgba(15,23,42,.9);
      border-top:1px solid var(--border-subtle);
      padding:10px 14px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size:13px;
      color:#e5e7eb;
      border-radius:0 0 var(--radius-md) var(--radius-md);
    }
    .pop-toggle span{
      font-weight:500;
      color:#e5e7eb;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .pop-toggle span::before{
      content:"";
      width:7px; height:7px;
      border-radius:999px;
      background:#22c55e;
      box-shadow:0 0 0 3px rgba(22,163,74,.2);
    }
    .pop-toggle i{
      transition:transform .2s;
      font-size:12px;
    }
    .pop-toggle.open i{ transform:rotate(180deg) }

    .switch-list{
      display:none;
      padding:8px 14px 14px 14px;
      overflow:visible;
      position:relative;
      background:radial-gradient(circle at top,#020617,#020617 60%);
      border-radius:0 0 var(--radius-md) var(--radius-md);
      border-top:1px solid rgba(30,64,175,.75);
    }

    .switch-row{
      background:rgba(15,23,42,.95);
      border:1px solid rgba(31,41,55,.95);
      border-radius:10px;
      padding:10px 10px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      position:relative;
      overflow:visible;
      margin-bottom:8px;
    }
    .switch-row:last-child{ margin-bottom:0; }

    .switch-info-wrap{
      display:flex;
      flex-direction:column;
      gap:3px;
    }
    .switch-name{
      font-weight:600;
      color:#e5e7eb;
      font-size:14px;
    }
    .switch-meta{
      font-size:12px;
      color:#9ca3af;
    }

    .row-actions{
      display:flex;
      gap:6px;
      align-items:center;
    }

    .hover-preview{ 
      position:absolute; 
      top:50%; 
      left:100%; 
      transform:translate(12px, -50%) scale(.96); 
      width:320px; 
      max-width:90vw; 
      max-height:300px; 
      background:rgba(15,23,42,.98); 
      border:1px solid rgba(30,64,175,.9); 
      border-radius:14px; 
      box-shadow:0 30px 60px rgba(15,23,42,1); 
      padding:10px; 
      opacity:0; 
      pointer-events:none; 
      transition:opacity .15s ease, transform .15s ease; 
      z-index:999;
      backdrop-filter:blur(12px);
    }
    .switch-row:hover .hover-preview{ 
      opacity:1; 
      transform:translate(12px, -50%) scale(1); 
      pointer-events:auto;
    }
    .hover-preview::before{ 
      content:""; 
      position:absolute; 
      top:50%; 
      left:-14px; 
      transform:translateY(-50%); 
      border-width:8px; 
      border-style:solid; 
      border-color:transparent rgba(30,64,175,.9) transparent transparent; 
    }
    .hover-preview::after{ 
      content:""; 
      position:absolute; 
      top:50%; 
      left:-13px; 
      transform:translateY(-50%); 
      border-width:8px; 
      border-style:solid; 
      border-color:transparent rgba(15,23,42,.98) transparent transparent; 
    }
    .hover-preview img{
      width:100%;
      height:auto;
      display:block;
      border-radius:8px;
      object-fit:cover;
      max-height:220px;
      border:1px solid rgba(30,64,175,.9);
    }
    .hover-preview .noimg{
      color:#9ca3af;
      font-size:13px;
      text-align:center;
      padding:16px 6px;
    }
    .hover-preview .copy-btn{
      margin-top:8px;
      width:100%;
      justify-content:center;
      pointer-events:auto;
      background:var(--accent-soft);
      color:#dbeafe;
      border:1px solid rgba(37,99,235,.8);
    }
    .hover-preview .copy-btn:hover{
      background:var(--accent-soft-strong);
    }

    .modal{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,.75);
      display:none;
      align-items:center;
      justify-content:center;
      padding:20px;
      z-index:1200;
      backdrop-filter:blur(10px);
    }
    .modal.open{ display:flex }
    .modal-content{
      background:#020617;
      width:min(900px, 100%);
      max-height:90vh;
      border-radius:18px;
      box-shadow:0 28px 80px rgba(0,0,0,.95);
      overflow:auto;
      border:1px solid rgba(30,64,175,.9);
    }
    .modal-header{
      padding:14px 18px;
      border-bottom:1px solid rgba(30,64,175,.8);
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:radial-gradient(circle at top left,rgba(59,130,246,.25),transparent 60%);
    }
    .modal-title{
      font-size:15px;
      font-weight:600;
      color:#e5e7eb;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .modal-body{ padding:18px 18px 12px }
    .modal-footer{
      padding:12px 18px 14px;
      border-top:1px solid rgba(30,64,175,.75);
      display:flex;
      gap:10px;
      justify-content:flex-end;
      background:#020617;
    }
    .close-x{
      background:transparent;
      border:0;
      font-size:20px;
      cursor:pointer;
      color:#9ca3af;
      border-radius:999px;
      width:30px; height:30px;
      display:grid;
      place-items:center;
      transition:background .15s, color .15s;
    }
    .close-x:hover{
      background:rgba(15,23,42,.9);
      color:#e5e7eb;
    }

    .form-group{ margin-bottom:14px }
    label{
      display:block;
      margin-bottom:6px;
      font-weight:500;
      color:#e5e7eb;
      font-size:13px;
    }
    input,select{
      width:100%;
      padding:10px 11px;
      border:1px solid rgba(30,64,175,.85);
      border-radius:8px;
      transition:border-color .2s, box-shadow .2s, background .2s;
      background:rgba(15,23,42,.95);
      color:#e5e7eb;
      font-size:13px;
    }
    input::placeholder{
      color:#6b7280;
    }
    input:focus,select:focus{
      border-color:#60a5fa;
      outline:0;
      box-shadow:0 0 0 1px rgba(37,99,235,.9);
      background:#020617;
    }
    .file-input-wrapper{
      position:relative;
      overflow:hidden;
      display:inline-block;
      width:100%;
    }
    .file-input-wrapper input[type=file]{
      position:absolute;
      left:0; top:0;
      opacity:0;
      width:100%; height:100%;
      cursor:pointer;
    }
    .file-input-button{
      display:block;
      padding:9px 11px;
      background:rgba(15,23,42,1);
      border:1px solid rgba(51,65,85,.9);
      border-radius:8px;
      text-align:center;
      cursor:pointer;
      transition:background .2s,border-color .2s,box-shadow .2s;
      font-size:13px;
      color:#e5e7eb;
    }
    .file-input-button:hover{
      background:rgba(15,23,42,.95);
      border-color:#60a5fa;
      box-shadow:0 0 0 1px rgba(37,99,235,.7);
    }

    .btn{
      background:var(--accent);
      color:#e5e7eb;
      border:0;
      padding:9px 14px;
      border-radius:999px;
      cursor:pointer;
      font-weight:600;
      transition:.2s background,.2s box-shadow,.1s transform;
      display:inline-flex;
      align-items:center;
      gap:7px;
      font-size:13px;
      box-shadow:0 18px 40px rgba(37,99,235,.45);
    }
    .btn:hover{
      background:#2563eb;
      box-shadow:0 22px 55px rgba(37,99,235,.65);
      transform:translateY(-1px);
    }
    .btn:active{ transform:translateY(1px); box-shadow:none; }
    .btn.ghost{
      background:rgba(15,23,42,.95);
      color:#e5e7eb;
      border:1px solid rgba(148,163,184,.5);
      box-shadow:none;
    }
    .btn.ghost:hover{
      background:#020617;
      box-shadow:0 12px 30px rgba(15,23,42,.9);
      border-color:#9ca3af;
    }
    .btn.danger{
      background:var(--danger);
      box-shadow:0 18px 40px rgba(239,68,68,.4);
    }
    .btn.danger:hover{
      background:#dc2626;
      box-shadow:0 22px 55px rgba(239,68,68,.6);
    }
    .btn.small{
      padding:6px 10px;
      font-size:12px;
      box-shadow:none;
    }
    .btn.small:hover{
      box-shadow:0 12px 30px rgba(15,23,42,.8);
    }

    .btn:focus-visible{
      outline:2px solid #f97316;
      outline-offset:2px;
    }

    .hide{ display:none !important }

    .loading-wrap{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:26px 18px;
      min-height:120px;
      gap:10px;
    }
    .progress{
      width:100%;
      max-width:380px;
      height:7px;
      background:#020617;
      border-radius:999px;
      overflow:hidden;
      position:relative;
      border:1px solid rgba(30,64,175,.9);
    }
    .progress .indeterminate{
      position:absolute;
      left:-40%; top:0; bottom:0;
      width:40%;
      background:linear-gradient(90deg,#3b82f6,#a855f7);
      animation:indeterminate 1.2s infinite linear;
    }
    @keyframes indeterminate{
      0%{left:-40%; width:40%}
      50%{left:30%; width:30%}
      100%{left:100%; width:40%}
    }

    /* ====== BLOQUEIO VISUAL ====== */
    body.locked .row-actions{ display:none !important }
    body.locked #menuNovoCadastro,
    body.locked #menuGerenciarPops{ display:none !important }
    body.locked .lock-badge{
      background:#450a0a;
      border-color:#7f1d1d;
      color:#fecaca;
    }

    /* ====== Modal de Senha ====== */
    .password-field{ position:relative }
    .password-field input{
      width:100%;
      padding-right:40px;
    }
    .password-field .eye{
      position:absolute;
      right:7px; top:50%;
      transform:translateY(-50%);
      width:30px; height:30px;
      border:0;
      background:transparent;
      cursor:pointer;
      border-radius:999px;
      display:grid;
      place-items:center;
      color:#9ca3af;
      transition:background .15s,color .15s;
    }
    .password-field .eye:hover{
      background:rgba(15,23,42,.95);
      color:#e5e7eb;
    }
    .input-hint{
      color:#fca5a5;
      margin-top:6px;
      font-size:12px;
    }

    /* ====== MINI GALERIA ====== */
    .mini-gallery{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:8px;
    }
    .mini-thumb{
      width:70px;
      height:50px;
      border-radius:6px;
      overflow:hidden;
      border:1px solid rgba(31,41,55,.95);
      background:radial-gradient(circle at top,#020617,#020617 65%);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      cursor:pointer;
      transition:transform .15s, box-shadow .15s, border-color .15s, background .15s;
    }
    .mini-thumb:hover{
      transform:scale(1.05) translateY(-1px);
      box-shadow:0 10px 25px rgba(15,23,42,.9);
      border-color:#3b82f6;
      background:radial-gradient(circle at top,#020617,#020617 55%);
    }
    .mini-thumb.selected{
      border-color:#3b82f6;
      box-shadow:0 0 0 1px rgba(37,99,235,.9),0 14px 32px rgba(15,23,42,1);
    }
    .mini-thumb img{
      max-width:100%;
      max-height:100%;
      display:block;
      object-fit:cover;
      border-radius:4px;
    }
    .mini-thumb span{
      font-size:11px;
      color:#9ca3af;
    }

    /* ====== TABELA POPs ====== */
    #tabelaPops{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
      color:#e5e7eb;
    }
    #tabelaPops thead tr{
      background:rgba(15,23,42,.95);
    }
    #tabelaPops thead th{
      padding:8px 10px;
      text-align:left;
      font-weight:500;
      border-bottom:1px solid rgba(30,64,175,.9);
      position:sticky;
      top:0;
      background:rgba(15,23,42,.98);
      z-index:1;
    }
    #tabelaPops tbody tr{
      border-bottom:1px solid rgba(15,23,42,.95);
      background:rgba(2,6,23,.98);
    }
    #tabelaPops tbody tr:nth-child(odd){
      background:rgba(15,23,42,.98);
    }
    #tabelaPops td{
      padding:7px 8px;
      vertical-align:middle;
    }

    /* ========= Acessibilidade foco geral ========= */
    a,button,input,select{
      outline:none;
    }
    a:focus-visible,
    button:focus-visible,
    input:focus-visible,
    select:focus-visible{
      outline:2px solid #f97316;
      outline-offset:2px;
    }
  </style>
</head>

<body class="sidebar-collapsed locked">
  <!-- VIDEO OCULTO PARA FAVICON ANIMADO -->
  <video id="favVideo" width="256" height="256" preload="auto" muted playsinline loop
         crossorigin="anonymous"
         style="position:absolute; left:-9999px; width:256px; height:256px; visibility:hidden; background:transparent url('https://cdn-icons-png.flaticon.com/512/19034/19034328.png') 50% 50% / contain no-repeat;">
    <source src="https://cdn-icons-mp4.flaticon.com/512/19034/19034328.mp4" type="video/mp4">
  </video>

  <div class="sidebar-overlay" onclick="document.body.classList.remove('sidebar-open')"></div>
  <div class="edge-hitbox" id="edgeHitbox" aria-hidden="true"></div>

  <aside class="sidebar" aria-label="Menu lateral">
    <div class="brand">
      <div class="brand-left">
        <div class="logo">GR</div>
        <div class="title"><b>GEST√ÉO</b>SWITCHES</div>
      </div>
      <button class="collapse-btn" id="btnCollapse" aria-expanded="false" title="Mostrar menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        <span>MENU</span>
      </button>
    </div>

    <nav class="menu">
      <h4>A√ß√µes</h4>
      <div class="item" id="menuNovoCadastro" data-label="Novo cadastro" role="button" tabindex="0">
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"></path></svg>
        </span>
        <span>Novo cadastro</span>
      </div>

      <div class="item" id="menuGerenciarPops" data-label="Gerenciar POPs" role="button" tabindex="0">
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.07a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.07c.18 0 .35-.04.51-.11.61-.25 1-.85 1-1.51V9c0-.66-.39-1.26-1-1.51A2 2 0 1 1 5.93 4.1l.06.06c.51.51 1.23.66 1.89.45H9c.66 0 1.24-.39 1.51-1V3a2 2 0 1 1 4 0v.07c.27.6.85.99 1.51 1h.1c.66 0 1.27-.26 1.72-.71l.06-.06A2 2 0 1 1 20.93 6.1l-.06.06c-.34.47-.49 1.06-.45 1.64V9c0 .66.39 1.26 1 1.51.16.07.33.11.51.11H21a2 2 0 1 1 0 4h-.07c-.18 0-.35.04-.51.11-.61.25-1 .85-1 1.51z"></path>
          </svg>
        </span>
        <span>Gerenciar POPs</span>
      </div>
    </nav>

    <!-- Rodap√© com bot√£o de cadeado -->
    <div class="sidebar-footer">
      <button class="lock-btn" id="lockBtn" title="Bloquear/Desbloquear">
        <img id="lockIcon" alt="cadeado" src="https://cdn-icons-png.flaticon.com/512/7615/7615902.png">
        <span id="lockText">Bloqueado</span>
        <span class="lock-badge" id="lockBadge">LOCK</span>
      </button>
    </div>
  </aside>

  <div class="with-sidebar">
    <div class="container">
      <header>
        <div class="header-row">
          <div class="header-main">
            <h1>Gest√£o de Switches de Rede</h1>
            <p class="subtitle">Todos ‚Üí Switches de POPs</p>
          </div>
          <div class="header-meta">
            <div class="env-badge">
              <span class="env-dot"></span>
              <span>Ambiente de Produ√ß√£o</span>
            </div>
            <div class="header-stats">
              <div class="stat-chip">
                <span>POPs ativos</span><strong id="statPops">‚Äî</strong>
              </div>
              <div class="stat-chip">
                <span>Switches</span><strong id="statSwitches">‚Äî</strong>
              </div>
            </div>
          </div>
        </div>
      </header>

      <div class="main-content">
        <section class="switches-section">
          <h2>POPs Cadastrados</h2>
          <div id="estadoContainer">
            <div id="estadoLoading" class="loading-wrap" role="status" aria-live="polite" aria-busy="true">
              <div class="progress" aria-hidden="true"><div class="indeterminate"></div></div>
              <div class="muted" style="text-align:center;margin-top:8px">Carregando‚Ä¶</div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Confirm/Alert modal reutiliz√°vel -->
  <div class="modal" id="confirmModal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="confirmModalTitle">
    <div class="modal-content" style="max-width:600px">
      <div class="modal-header">
        <div class="modal-title" id="confirmModalTitle">Confirmar</div>
        <button class="close-x" data-close="confirmModal" aria-label="Fechar">&times;</button>
      </div>
      <div class="modal-body">
        <p id="confirmModalMessage" style="margin:0; color:#e5e7eb; line-height:1.5"></p>
      </div>
      <div class="modal-footer">
        <button class="btn ghost" id="confirmCancelBtn">Cancelar</button>
        <button class="btn danger" id="confirmOkBtn">Remover</button>
      </div>
    </div>
  </div>

  <!-- Modal de Senha -->
  <div class="modal" id="passwordModal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="passwordTitle">
    <div class="modal-content" style="max-width:420px">
      <div class="modal-header">
        <div class="modal-title" id="passwordTitle">Destravar</div>
        <button class="close-x" data-close="passwordModal" aria-label="Fechar">&times;</button>
      </div>
      <form class="modal-body" id="passwordForm">
        <label for="passwordInput" class="muted" style="display:block;margin-bottom:6px">
          Digite a senha para destravar:
        </label>
        <div class="password-field">
          <input type="password" id="passwordInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" required>
          <button type="button" class="eye" id="togglePass" aria-label="Mostrar/ocultar senha" title="Mostrar/ocultar senha">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
          </button>
        </div>
        <div class="input-hint" id="passwordError" style="display:none">Senha incorreta. Tente novamente.</div>
      </form>
      <div class="modal-footer">
        <button class="btn ghost" type="button" data-close="passwordModal">Cancelar</button>
        <button class="btn" id="passwordOkBtn" form="passwordForm">OK</button>
      </div>
    </div>
  </div>

  <!-- SUGEST√ïES DE MODELOS -->
  <datalist id="modelosBase">
    <option value="Datacom DM3000"></option>
    <option value="Datacom DM4100"></option>
    <option value="Datacom EDD 2104"></option>
    <option value="Cisco Catalyst 2960"></option>
    <option value="Cisco Catalyst 9200"></option>
    <option value="Huawei S5720"></option>
    <option value="HP/Aruba 2530"></option>
    <option value="MikroTik CRS326"></option>
    <option value="Juniper EX3300"></option>
    <option value="Planet GSW"></option>
  </datalist>

  <!-- Modal Novo Cadastro -->
  <div class="modal" id="modalNovo" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="modalNovoTitle">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="modalNovoTitle">Novo Switch</div>
        <button class="close-x" data-close="modalNovo" aria-label="Fechar">&times;</button>
      </div>
      <form class="modal-body" id="formNovo">
        <div class="form-group">
          <label for="novoNome">Nome do Switch</label>
          <input type="text" id="novoNome" placeholder="Ex: SW-POP-01" required>
        </div>
        <div class="form-group">
          <label for="novoModelo">Modelo</label>
          <input type="text" id="novoModelo" list="modelosBase" placeholder="Ex: Datacom DM3000" required>
        </div>
        <div class="form-group">
          <label for="novoIp">IP</label>
          <input type="text" id="novoIp" placeholder="Ex: 192.168.1.10" required>
        </div>
        <div class="form-group">
          <label for="novoUf">UF</label>
          <select id="novoUf" required>
            <option value="">Selecione</option>
            <option value="AC">AC</option><option value="AL">AL</option><option value="AP">AP</option>
            <option value="AM">AM</option><option value="BA">BA</option><option value="CE">CE</option>
            <option value="DF">DF</option><option value="ES">ES</option><option value="GO">GO</option>
            <option value="MA">MA</option><option value="MT">MT</option><option value="MS">MS</option>
            <option value="MG">MG</option><option value="PA">PA</option><option value="PB">PB</option>
            <option value="PR">PR</option><option value="PE">PE</option><option value="PI">PI</option>
            <option value="RJ">RJ</option><option value="RN">RN</option><option value="RS">RS</option>
            <option value="RO">RO</option><option value="RR">RR</option><option value="SC">SC</option>
            <option value="SP">SP</option><option value="SE">SE</option><option value="TO">TO</option>
          </select>
        </div>
        <div class="form-group">
          <label for="novoPop">POP</label>
          <input type="text" id="novoPop" placeholder="Ex: POP-Centro" required>
        </div>
        <div class="form-group">
          <label for="novoFotos">Fotos (m√∫ltiplas)</label>
          <div class="file-input-wrapper">
            <input type="file" id="novoFotos" accept="image/*" multiple>
            <div class="file-input-button">Escolher arquivos</div>
          </div>
        </div>
      </form>
      <div class="modal-footer">
        <button class="btn ghost" type="button" data-close="modalNovo">Cancelar</button>
        <button class="btn" form="formNovo">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Modal Editar -->
  <div class="modal" id="modalEditar" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="modalEditarTitle">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="modalEditarTitle">Editar Switch</div>
        <button class="close-x" data-close="modalEditar" aria-label="Fechar">&times;</button>
      </div>
      <form class="modal-body" id="formEditar">
        <input type="hidden" id="editId">
        <div class="form-group">
          <label for="editNome">Nome do Switch</label>
          <input type="text" id="editNome" required>
        </div>
        <div class="form-group">
          <label for="editModelo">Modelo</label>
          <input type="text" id="editModelo" list="modelosBase" required>
        </div>
        <div class="form-group">
          <label for="editIp">IP</label>
          <input type="text" id="editIp" required>
        </div>
        <div class="form-group">
          <label for="editUf">UF</label>
          <select id="editUf" required>
            <option value="">Selecione</option>
            <option value="AC">AC</option><option value="AL">AL</option><option value="AP">AP</option>
            <option value="AM">AM</option><option value="BA">BA</option><option value="CE">CE</option>
            <option value="DF">DF</option><option value="ES">ES</option><option value="GO">GO</option>
            <option value="MA">MA</option><option value="MT">MT</option><option value="MS">MS</option>
            <option value="MG">MG</option><option value="PA">PA</option><option value="PB">PB</option>
            <option value="PR">PR</option><option value="PE">PE</option><option value="PI">PI</option>
            <option value="RJ">RJ</option><option value="RN">RN</option><option value="RS">RS</option>
            <option value="RO">RO</option><option value="RR">RR</option><option value="SC">SC</option>
            <option value="SP">SP</option><option value="SE">SE</option><option value="TO">TO</option>
          </select>
        </div>
        <div class="form-group">
          <label for="editPop">POP</label>
          <input type="text" id="editPop" required>
        </div>

        <div class="form-group">
          <label>Fotos atuais</label>
          <div class="mini-gallery" id="editGallery"></div>
        </div>

        <div class="form-group">
          <label for="editFotos">Adicionar novas fotos</label>
          <div class="file-input-wrapper">
            <input type="file" id="editFotos" accept="image/*" multiple>
            <div class="file-input-button">Escolher arquivos</div>
          </div>
        </div>
      </form>
      <div class="modal-footer">
        <button class="btn ghost" type="button" data-close="modalEditar">Cancelar</button>
        <button class="btn" form="formEditar">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Modal Gerenciar POPs -->
  <div class="modal" id="modalPops" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="modalPopsTitle">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="modalPopsTitle">Gerenciar POPs</div>
        <button class="close-x" data-close="modalPops" aria-label="Fechar">&times;</button>
      </div>
      <div class="modal-body">
        <table id="tabelaPops">
          <thead>
            <tr>
              <th>UF</th>
              <th>POP</th>
              <th>Switches</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button class="btn ghost" data-close="modalPops">Fechar</button>
      </div>
    </div>
  </div>

  <!-- Modal Renomear POP -->
  <div class="modal" id="modalRenamePop" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="modalRenamePopTitle">
    <div class="modal-content" style="max-width:500px">
      <div class="modal-header">
        <div class="modal-title" id="modalRenamePopTitle">Renomear POP</div>
        <button class="close-x" data-close="modalRenamePop" aria-label="Fechar">&times;</button>
      </div>
      <form class="modal-body" id="formRenamePop">
        <input type="hidden" id="renamePopUf">
        <input type="hidden" id="renamePopOld">
        <div class="form-group">
          <label for="renamePopNew">Novo nome do POP</label>
          <input type="text" id="renamePopNew" placeholder="Ex: POP-Centro-Novo" required>
        </div>
      </form>
      <div class="modal-footer">
        <button class="btn ghost" type="button" data-close="modalRenamePop">Cancelar</button>
        <button class="btn" form="formRenamePop">Salvar</button>
      </div>
    </div>
  </div>

  <script type="module">
    // ========== FIREBASE CONFIG ==========
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import {
      getDatabase, ref, onValue, push, set, update, remove
    } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDLow_NP7r7Ks7Uh_zzYPXQXxJqLxqLZqo",
      authDomain: "switches-de-rede.firebaseapp.com",
      databaseURL: "https://switches-de-rede-default-rtdb.firebaseio.com",
      projectId: "switches-de-rede",
      storageBucket: "switches-de-rede.firebasestorage.app",
      messagingSenderId: "1059024356856",
      appId: "1:1059024356856:web:c0e0e0e0e0e0e0e0e0e0e0"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const switchesRef = ref(db, 'switches');

    // ========== ESTADO GLOBAL ==========
    let allSwitches = [];
    let switchesByPop = {};
    let switchCountByUf = {};

    // ========== SENHA PARA DESTRAVAR ==========
    const UNLOCK_PASSWORD = '1234';

    // ========== HELPERS ==========
    function openModal(id) {
      const m = document.getElementById(id);
      if (m) {
        m.classList.add('open');
        m.setAttribute('aria-hidden', 'false');
      }
    }
    function closeModal(id) {
      const m = document.getElementById(id);
      if (m) {
        m.classList.remove('open');
        m.setAttribute('aria-hidden', 'true');
      }
    }

    function showConfirm(message, onOk) {
      document.getElementById('confirmModalMessage').textContent = message;
      openModal('confirmModal');
      const okBtn = document.getElementById('confirmOkBtn');
      const cancelBtn = document.getElementById('confirmCancelBtn');
      const handler = () => {
        closeModal('confirmModal');
        onOk();
        okBtn.removeEventListener('click', handler);
      };
      okBtn.addEventListener('click', handler);
      cancelBtn.onclick = () => closeModal('confirmModal');
    }

    function fileToDataURL(file) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (e) => resolve(e.target.result);
        reader.readAsDataURL(file);
      });
    }

    // ========== AGRUPAMENTO OTIMIZADO ==========
    function groupSwitchesByPop(switches) {
      const grouped = {};
      const ufCounts = {};
      switches.forEach(sw => {
        const key = `${sw.uf}|${sw.pop}`;
        if (!grouped[key]) grouped[key] = [];
        grouped[key].push(sw);
        ufCounts[sw.uf] = (ufCounts[sw.uf] || 0) + 1;
      });
      return { grouped, ufCounts };
    }

    // ========== RENDER OTIMIZADO ==========
    function renderEstadosComPops() {
      const container = document.getElementById('estadoContainer');
      container.innerHTML = '';

      if (allSwitches.length === 0) {
        container.innerHTML = '<div class="no-switches">Nenhum switch cadastrado.</div>';
        return;
      }

      const { grouped, ufCounts } = groupSwitchesByPop(allSwitches);
      switchesByPop = grouped;
      switchCountByUf = ufCounts;

      const ufs = [...new Set(allSwitches.map(s => s.uf))].sort();

      ufs.forEach(uf => {
        const estadoDiv = document.createElement('div');
        estadoDiv.className = 'estado-block';

        const totalSw = ufCounts[uf] || 0;
        const popsInUf = Object.keys(grouped).filter(k => k.startsWith(uf + '|'));

        estadoDiv.innerHTML = `
          <div class="estado-head">
            <div class="h3">${uf}</div>
            <div class="estado-badge">${popsInUf.length} POP(s) ‚Ä¢ ${totalSw} switch(es)</div>
          </div>
          <div class="pop-grid" id="popGrid-${uf}"></div>
        `;
        container.appendChild(estadoDiv);

        const popGrid = document.getElementById(`popGrid-${uf}`);
        popsInUf.forEach(key => {
          const [, popName] = key.split('|');
          const switches = grouped[key];
          const popCard = document.createElement('div');
          popCard.className = 'pop-card';
          popCard.innerHTML = `
            <div class="pop-header">
              <div class="pop-title">${popName}</div>
              <div class="pop-badge">${switches.length} switch(es)</div>
            </div>
            <button class="pop-toggle" data-pop="${key}">
              <span>Ver switches</span>
              <i>‚ñº</i>
            </button>
            <div class="switch-list" id="list-${key.replace(/\|/g, '-')}"></div>
          `;
          popGrid.appendChild(popCard);

          const toggleBtn = popCard.querySelector('.pop-toggle');
          const listDiv = popCard.querySelector('.switch-list');
          toggleBtn.addEventListener('click', () => {
            const isOpen = listDiv.style.display === 'block';
            listDiv.style.display = isOpen ? 'none' : 'block';
            toggleBtn.classList.toggle('open', !isOpen);
          });

          switches.forEach(sw => {
            const row = document.createElement('div');
            row.className = 'switch-row';
            row.innerHTML = `
              <div class="switch-info-wrap">
                <div class="switch-name">${sw.nome}</div>
                <div class="switch-meta">${sw.modelo} ‚Ä¢ ${sw.ip}</div>
              </div>
              <div class="row-actions">
                <button class="btn small ghost" data-edit="${sw.id}" title="Editar">‚úèÔ∏è</button>
                <button class="btn small danger" data-delete="${sw.id}" title="Remover">üóëÔ∏è</button>
              </div>
              <div class="hover-preview">
                ${sw.fotos && sw.fotos.length > 0
                  ? `<img src="${sw.fotos[0]}" alt="Foto do switch">
                     <button class="btn small copy-btn" data-copy="${sw.fotos[0]}">üìã Copiar imagem</button>`
                  : '<div class="noimg">Sem foto</div>'}
              </div>
            `;
            listDiv.appendChild(row);
          });
        });
      });

      // Atualizar stats no header
      const totalPops = Object.keys(switchesByPop).length;
      document.getElementById('statPops').textContent = totalPops;
      document.getElementById('statSwitches').textContent = allSwitches.length;

      attachRowActions();
    }

    function attachRowActions() {
      document.querySelectorAll('[data-edit]').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-edit');
          const sw = allSwitches.find(s => s.id === id);
          if (sw) abrirModalEditar(sw);
        });
      });
      document.querySelectorAll('[data-delete]').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-delete');
          showConfirm('Tem certeza que deseja remover este switch?', () => deletarSwitch(id));
        });
      });
      document.querySelectorAll('[data-copy]').forEach(btn => {
        btn.addEventListener('click', async () => {
          const dataUrl = btn.getAttribute('data-copy');
          try {
            const blob = await (await fetch(dataUrl)).blob();
            await navigator.clipboard.write([new ClipboardItem({ [blob.type]: blob })]);
            btn.textContent = '‚úÖ Copiado!';
            setTimeout(() => { btn.innerHTML = 'üìã Copiar imagem'; }, 1500);
          } catch (err) {
            alert('Erro ao copiar imagem.');
          }
        });
      });
    }

    // ========== FIREBASE LISTENER ==========
    let lastSnapshot = null;
    function renderWhenReady(snapshot) {
      const currentData = JSON.stringify(snapshot.val());
      if (currentData === lastSnapshot) return;
      lastSnapshot = currentData;

      allSwitches = [];
      snapshot.forEach(child => {
        allSwitches.push({ id: child.key, ...child.val() });
      });
      renderEstadosComPops();
      document.getElementById('estadoLoading').classList.add('hide');
    }

    onValue(switchesRef, renderWhenReady);

    // ========== NOVO CADASTRO ==========
    document.getElementById('formNovo').addEventListener('submit', async (e) => {
      e.preventDefault();
      const nome = document.getElementById('novoNome').value.trim();
      const modelo = document.getElementById('novoModelo').value.trim();
      const ip = document.getElementById('novoIp').value.trim();
      const uf = document.getElementById('novoUf').value;
      const pop = document.getElementById('novoPop').value.trim();
      const files = document.getElementById('novoFotos').files;

      const fotos = [];
      for (let f of files) {
        fotos.push(await fileToDataURL(f));
      }

      await push(switchesRef, { nome, modelo, ip, uf, pop, fotos });
      closeModal('modalNovo');
      document.getElementById('formNovo').reset();
    });

    // ========== EDITAR ==========
    let editingFotos = [];
    let removedIndexes = new Set();

    function abrirModalEditar(sw) {
      document.getElementById('editId').value = sw.id;
      document.getElementById('editNome').value = sw.nome;
      document.getElementById('editModelo').value = sw.modelo;
      document.getElementById('editIp').value = sw.ip;
      document.getElementById('editUf').value = sw.uf;
      document.getElementById('editPop').value = sw.pop;

      editingFotos = sw.fotos ? [...sw.fotos] : [];
      removedIndexes.clear();

      renderEditGallery();
      openModal('modalEditar');
    }

    function renderEditGallery() {
      const gallery = document.getElementById('editGallery');
      gallery.innerHTML = '';
      editingFotos.forEach((url, i) => {
        if (removedIndexes.has(i)) return;
        const thumb = document.createElement('div');
        thumb.className = 'mini-thumb';
        thumb.innerHTML = `<img src="${url}" alt="Foto ${i + 1}">`;
        thumb.addEventListener('click', () => {
          removedIndexes.add(i);
          renderEditGallery();
        });
        gallery.appendChild(thumb);
      });
      if (editingFotos.length === 0 || removedIndexes.size === editingFotos.length) {
        gallery.innerHTML = '<span class="muted">Nenhuma foto</span>';
      }
    }

    document.getElementById('formEditar').addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = document.getElementById('editId').value;
      const nome = document.getElementById('editNome').value.trim();
      const modelo = document.getElementById('editModelo').value.trim();
      const ip = document.getElementById('editIp').value.trim();
      const uf = document.getElementById('editUf').value;
      const pop = document.getElementById('editPop').value.trim();

      const keptFotos = editingFotos.filter((_, i) => !removedIndexes.has(i));
      const newFiles = document.getElementById('editFotos').files;
      for (let f of newFiles) {
        keptFotos.push(await fileToDataURL(f));
      }

      await update(ref(db, `switches/${id}`), { nome, modelo, ip, uf, pop, fotos: keptFotos });
      closeModal('modalEditar');
      document.getElementById('formEditar').reset();
    });

    // ========== DELETAR ==========
    async function deletarSwitch(id) {
      await remove(ref(db, `switches/${id}`));
    }

    // ========== GERENCIAR POPs ==========
    document.getElementById('menuGerenciarPops').addEventListener('click', () => {
      renderTabelaPops();
      openModal('modalPops');
    });

    function renderTabelaPops() {
      const tbody = document.querySelector('#tabelaPops tbody');
      tbody.innerHTML = '';

      const pops = Object.keys(switchesByPop).map(key => {
        const [uf, pop] = key.split('|');
        return { uf, pop, count: switchesByPop[key].length };
      }).sort((a, b) => a.uf.localeCompare(b.uf) || a.pop.localeCompare(b.pop));

      pops.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.uf}</td>
          <td>${p.pop}</td>
          <td>${p.count}</td>
          <td>
            <button class="btn small ghost" data-rename-uf="${p.uf}" data-rename-pop="${p.pop}">‚úèÔ∏è Renomear</button>
            <button class="btn small danger" data-delete-pop-uf="${p.uf}" data-delete-pop="${p.pop}">üóëÔ∏è Remover POP</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      tbody.querySelectorAll('[data-rename-uf]').forEach(btn => {
        btn.addEventListener('click', () => {
          const uf = btn.getAttribute('data-rename-uf');
          const pop = btn.getAttribute('data-rename-pop');
          abrirModalRenamePop(uf, pop);
        });
      });

      tbody.querySelectorAll('[data-delete-pop-uf]').forEach(btn => {
        btn.addEventListener('click', () => {
          const uf = btn.getAttribute('data-delete-pop-uf');
          const pop = btn.getAttribute('data-delete-pop');
          showConfirm(`Remover o POP "${pop}" e todos os seus switches?`, () => deletarPop(uf, pop));
        });
      });
    }

    function abrirModalRenamePop(uf, oldPop) {
      document.getElementById('renamePopUf').value = uf;
      document.getElementById('renamePopOld').value = oldPop;
      document.getElementById('renamePopNew').value = oldPop;
      openModal('modalRenamePop');
    }

    document.getElementById('formRenamePop').addEventListener('submit', async (e) => {
      e.preventDefault();
      const uf = document.getElementById('renamePopUf').value;
      const oldPop = document.getElementById('renamePopOld').value;
      const newPop = document.getElementById('renamePopNew').value.trim();

      const key = `${uf}|${oldPop}`;
      const switches = switchesByPop[key] || [];
      for (let sw of switches) {
        await update(ref(db, `switches/${sw.id}`), { pop: newPop });
      }

      closeModal('modalRenamePop');
      closeModal('modalPops');
    });

    async function deletarPop(uf, pop) {
      const key = `${uf}|${pop}`;
      const switches = switchesByPop[key] || [];
      for (let sw of switches) {
        await remove(ref(db, `switches/${sw.id}`));
      }
      closeModal('modalPops');
    }

    // ========== SIDEBAR & LOCK ==========
    const btnCollapse = document.getElementById('btnCollapse');
    const edgeHitbox = document.getElementById('edgeHitbox');
    const lockBtn = document.getElementById('lockBtn');
    const lockIcon = document.getElementById('lockIcon');
    const lockText = document.getElementById('lockText');
    const lockBadge = document.getElementById('lockBadge');

    btnCollapse.addEventListener('click', () => {
      const isCollapsed = document.body.classList.toggle('sidebar-collapsed');
      btnCollapse.setAttribute('aria-expanded', !isCollapsed);
    });

    if (window.innerWidth <= 900) {
      edgeHitbox.addEventListener('pointerenter', () => {
        document.body.classList.add('sidebar-open');
      });
    }

    lockBtn.addEventListener('click', () => {
      if (document.body.classList.contains('locked')) {
        openModal('passwordModal');
      } else {
        document.body.classList.add('locked');
        lockIcon.src = 'https://cdn-icons-png.flaticon.com/512/7615/7615902.png';
        lockText.textContent = 'Bloqueado';
        lockBadge.textContent = 'LOCK';
      }
    });

    document.getElementById('passwordForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const input = document.getElementById('passwordInput').value;
      const errorDiv = document.getElementById('passwordError');
      if (input === UNLOCK_PASSWORD) {
        document.body.classList.remove('locked');
        lockIcon.src = 'https://cdn-icons-png.flaticon.com/512/159/159478.png';
        lockText.textContent = 'Desbloqueado';
        lockBadge.textContent = 'UNLOCK';
        closeModal('passwordModal');
        document.getElementById('passwordForm').reset();
        errorDiv.style.display = 'none';
      } else {
        errorDiv.style.display = 'block';
      }
    });

    document.getElementById('togglePass').addEventListener('click', () => {
      const inp = document.getElementById('passwordInput');
      inp.type = inp.type === 'password' ? 'text' : 'password';
    });

    // ========== MENU ITEMS ==========
    document.getElementById('menuNovoCadastro').addEventListener('click', () => {
      openModal('modalNovo');
    });

    // ========== CLOSE MODALS ==========
    document.querySelectorAll('[data-close]').forEach(btn => {
      btn.addEventListener('click', () => {
        closeModal(btn.getAttribute('data-close'));
      });
    });

    // ========== RESIZE DEBOUNCE ==========
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        document.documentElement.classList.add('js-ready');
      }, 150);
    });

    // ========== INIT ==========
    setTimeout(() => {
      document.documentElement.classList.add('js-ready');
    }, 100);
  </script>

  <!-- FAVICON ANIMADO OTIMIZADO -->
  <script>
    (function() {
      const FPS = 4;
      const INTERVAL_MS = 1000 / FPS;
      const MAX_DURATION_MS = 15000;

      const video = document.getElementById('favVideo');
      const link = document.getElementById('dynamic-favicon');
      const canvas = document.createElement('canvas');
      canvas.width = 256;
      canvas.height = 256;
      const ctx = canvas.getContext('2d', { alpha: true, willReadFrequently: false });

      let animationStarted = false;
      let startTime = 0;
      let intervalId = null;

      function updateFavicon() {
        if (!video.paused && !video.ended) {
          const elapsed = Date.now() - startTime;
          if (elapsed > MAX_DURATION_MS) {
            clearInterval(intervalId);
            return;
          }
          ctx.clearRect(0, 0, 256, 256);
          ctx.drawImage(video, 0, 0, 256, 256);
          link.href = canvas.toDataURL('image/png');
        }
      }

      function startAnimation() {
        if (animationStarted) return;
        animationStarted = true;
        startTime = Date.now();
        video.play().catch(() => {});
        intervalId = setInterval(updateFavicon, INTERVAL_MS);
      }

      document.addEventListener('pointerdown', startAnimation, { once: true });
    })();
  </script>
</body>
</html>
